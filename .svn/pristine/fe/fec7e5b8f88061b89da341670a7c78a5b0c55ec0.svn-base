<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<title>聚农优享</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/public.css">
	<link rel="stylesheet" href="font/font_560087_tt31urijhi307ldi/iconfont.css">
	<link rel="stylesheet" href="css/index.css">
	<!-- <script src="./js/rem.js"></script> -->
	<script src="./js/vue.js"></script>
	<script src="js/index.js"></script>
	<script src="js/axios.min.js"></script>
	<script type="text/javascript" src="js/publick.js?v=1"></script>
	<script type="text/javascript" src="js/api.js"></script>
	<script type="text/javascript" src="./js/jweixin-1.4.0.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.8.7/lib/index.css">
	<script src="https://cdn.jsdelivr.net/npm/vant@2.8.7/lib/vant.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.8.0/dist/JsBarcode.all.min.js" ></script>
	<style>
		[v-cloak] {
			display: none;
		}
		
		html,body { font-size: 16px; height: 100%; }
		@media all and (max-width:375px) {
			body,html{
				font-size: 14px;
			}
		}
		@media only screen and (min-width: 414px) {
			body,html {
				font-size: 16px !important;
			}
		}
		@media only screen and (min-width: 480px) {
			body,html {
				font-size: 22px !important;
			}
		}
		#app { min-height: 100%; background: #f5f5f5; }
		div { box-sizing: border-box; }

		.overlay {
			background: rgba(0, 0, 0, .5);
			width: 100%;
			height: 100vh;
			position: fixed;
			top: 0;
			left: 0;
			z-index: 999;
		}

		.actionSheet {
			position: fixed;
			bottom: 0;
			left: 0;
			z-index: 1000;
			width: 100%;
			height: 100%;
			height: 401px;
			overflow-y: scroll;
			background: #f7f8fa;
			border-radius: 20px 20px 0 0;
		}

		.actionSheet h3 {
			line-height: 46px;
			position: relative;
			font-weight: bold;
			text-align: center;
			background: #fff;
			font-size: 1rem;
		}

		.actionSheet ul {
			height: 280px;
			overflow-y: auto;
			background: #fff;
			border-top: 1px solid #ebedf0;
		}

		.actionSheet ul li {
			height: 46px;
			line-height: 46px;
			text-align: center;
			
			position: relative;
		}

		.actionSheet ul li span {
			line-height: 46px;
			display: block;
		}

		.actionSheet p {
			position: fixed;
			bottom: 0;
			height: 46px;
			line-height: 46px;
			width: 100%;
			text-align: center;
			background: #fff;
			font-size: 1rem;
			display: flex;
			align-items: center;
			padding: 8px 0;
			
		}
		.van-cell{
				padding: 0;
				font-size: 0.75rem;
				color: #999999;
				background: transparent;
			}
			.van-cell__title,
			.van-cell__value {
			    flex: none;
			}
			.van-cell__value {
			    flex: 1;
			}
			p{
				margin: 0;
			}
		.list{
				width: 100%;
				height: 114px;
				margin: 0.625rem auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
				color: #999999;
				background: url(img/yhq2.png) no-repeat;background-size:100% 100%
			}
			.list .left{
				width: 23%;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 40px;
			}
			.list .left span{
				font-size: 1.875rem;
				font-weight: bold;
			}
			.list .left .juan-desc {
				font-size: 0.875rem;
			}
			.list .right{
				flex: 1;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-content: space-between;
				padding: 0 0.875rem;
			}
			.list .right>div{
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.list .right>div>p{
				display: flex;
				flex-direction: column;
				font-weight: bold;
				font-size: 1rem;
			}
			.list .right>div>p span{
				font-size: 0.875rem;
				font-weight: normal;
				margin-top: 8px;
				margin-bottom: 15px;
			}
			.unUsed{
				background: url(img/yhq.png) no-repeat;background-size:100% 100%
			}
			
			.unUsed .left{
				color: #FF2814;
			}
			.unUsed .right>div>p{
				color: #333333;
			}
			.list .right>div>p span{
				color: #999999;
			}
			
            .list button{
				border: none;
				font-size: 0.75rem;
				color: #999;
				border-radius: 0.75rem;
				background: -webkit-gradient(linear, 0 0, 0 100%, from(#e1e1e1), to(#f4f4f4));
				background: -webkit-linear-gradient(#e1e1e1, #f4f4f4);
				background: -moz-linear-gradient(#e1e1e1, #f4f4f4);
				background: -o-linear-gradient(#e1e1e1, #f4f4f4);
                background: linear-gradient(#e1e1e1, #f4f4f4);
                font-weight: 700;
				padding: 0.3rem 0.6rem;
            }
            .unUsed button{
				border: none;
                font-size: 0.75rem;
				color: #fff;
				border-radius: 0.75rem;
				background: -webkit-gradient(linear, 0 0, 0 100%, from(#02CF0A), to(#00BE34));
				background: -webkit-linear-gradient(#02CF0A, #00BE34);
				background: -moz-linear-gradient(#02CF0A, #00BE34);
				background: -o-linear-gradient(#02CF0A, #00BE34);
				background: linear-gradient(#02CF0A, #00BE34);
				padding: 0.3rem 0.6rem;
            }
		.no-touch { touch-action: none; }
		.touch { touch-action: auto; }
		 /* 导航栏 */
		.van-nav-bar { background: transparent; background: #e52e2b; }
		.van-nav-bar .van-icon { color: #fff; font-size: 1rem; }
		.van-nav-bar .van-nav-bar__right { position: absolute; top: 50%; transform: translateY(-50%); }
		.van-nav-bar .van-nav-bar__right img { display: block; }
		.van-nav-bar .van-nav-bar__title { font-weight: bold; color: #fff; }
		/* top */
		.ucenter .top { position: relative; }
		.ucenter .top .bg { width: 100%; }
		.ucenter .top .shop-info { position: absolute; bottom: -20px; left: 0; width: 100%; height: 3.75rem; padding: 0 0.75rem;; display: flex; align-items: center; }
        .ucenter .top .shop-info .left-con { width: 53%; height: 100%; display: flex; align-items: center; justify-content: center;  }
        .ucenter .top .shop-info .left-icon { width: 1.5rem; margin-right: 0.75rem; }
		.ucenter .top .shop-info .shop-addr { width: calc(100% - 2rem);  display: flex; flex-direction: column;  }
        .ucenter .top .shop-info .shop-addr .name { width: 100%; display: flex; align-items: center; }
		.ucenter .top .shop-info .shop-addr .name .text{ display: inline-block; max-width: calc(100% - 30px); font-size: 1rem; font-weight: bold; color: #000; white-space:nowrap; overflow: hidden; text-overflow: ellipsis;}
		.ucenter .top .shop-info .shop-addr .addr { font-size: 0.75rem; color:#6d6d6d; white-space:nowrap; overflow: hidden; text-overflow: ellipsis;}
		.ucenter .top .shop-info .right-con { width: 47%; height: 100%; display: flex;align-items: center;justify-content: center; }
        .ucenter .top .shop-info .tab-text {  font-size: 0.875rem; font-weight: 400; color: #333; margin-top: 0.625rem; }
        /* 优惠券bg */
		.pt-coupon-con { padding: 0 0.75rem; background: #fff; }
		.pt-coupon-con .pt-coupon-bg { width: 100%; }
        /* tab2导航栏 */
        .tab2-con .van-tab .van-tab__text { color: #888; font-size: 0.875rem; }
        .tab2-con .van-tab--active .van-tab__text { color: #333; font-size: 0.9rem; font-weight: bold; }
        .tab2-con .van-tabs__line { background-color: #333; }
		/* 列表 */
		.list-item { position: relative; padding: 0.75rem; padding-right: 0; display: flex; margin-top: 12px; }
		.list-item.bg1 { background: url('./images/yhq-item-bg1.png') no-repeat; background-size: 100% 100%; }
		.list-item.bg2 { background: url('./images/yhq-item-bg2.png') no-repeat; background-size: 100% 100%; }
		.list-item.bg3 { background: url('./images/yhq-item-bg3.png') no-repeat; background-size: 100% 100%; }
		.list-item .left { width: 75%; display: flex; flex-direction: column; align-items: center; }
		.list-item .left .left-top { display: flex; width: 100%; align-items: center}
		.list-item .left .left-top .shop-logo { width: 40px; height: 40px; border-radius: 4px; overflow: hidden; }
		.list-item .left .left-top .shop-logo img { width: 100%; height: 100%;}
		.list-item .left .left-top .shop-info { width: calc(100% - 40px); display: flex; align-items: center; flex-direction: column;padding-left: 8px }
		.list-item .left .left-top .shop-info .shop-tit { width: 100%;overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-size: 0.9rem; font-weight: bold; color: #333; }
		.list-item .left .left-top .shop-info .coupon-tit { width: 100%; font-size: 0.8rem; color: #888; padding-top: 0.2rem; }
		.list-item .left .left-bot { width: 100%; display: flex; flex-direction: column; align-items: center; padding-top: 1rem; }
		.list-item .left .left-bot .desc { width: 100%; font-size: 0.875rem; color: #888; padding-bottom: 0.5rem; }
		.list-item .left .left-bot .progress { width: 100%;}
		.list-item .left .left-bot .coupon-desc { width: 100%; display: flex; align-items: center; justify-content: space-between; }
		.list-item .left .left-bot .coupon-desc .cell { width: 100%; display: flex; align-items: center; font-size: 0.75rem; color: #888; }
		.list-item .left .left-bot .coupon-desc .cell .cell-left { flex: 1; }
		.list-item .left .left-bot .coupon-desc .cell .cell-right { min-width: 7rem; }
		.list-item .right { width: 25%; display: flex; flex-direction: column; align-items: center; justify-content: center;color: #fff; cursor: pointer; position: relative; }
		.list-item .right .top { color: #ffe6c4; }
		.list-item .right .top .price { font-size: 2rem; font-weight: bold; }
		.list-item .right .top .price-icon { font-size: 0.875rem; }
		.list-item .right .bot { font-size: 0.875rem; }
		.list-item .right.no-coupon .top .price,.list-item .right.no-coupon .top .price-icon,.list-item .right.no-coupon .bot { color: #B2B2B2;} 
		.list-item .yhq-type { position: absolute; width: 3rem; left: 0; top: 0; }
		.list-item .yhq-yl-icon { position: absolute; right: 0; top: 0; width: 4rem; }
		
		/* loading */
		.full-loading { position: fixed; left: 0; top: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.1); z-index: 9999; }
		.full-loading .van-loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%) }
		/* 无数据 */
		.no-data { position: relative; top: 0; left: 0; width: 100%; height: 300px; z-index: 99;}
		.no-data .no-data-con { position: absolute;  width: 90%; top: 50%; left: 50%; transform: translate(-50%,-50%); text-align: center; }
		.no-data .no-data-con img { width: 100%; }
		.no-data .no-data-con .no-title{ font-size: 1rem; font-weight:600;  color:rgba(0,0,0,1);  }
		.no-data .no-data-con .no-desc { font-size: 0.75rem; font-weight:400; color:rgba(136,136,136,1); padding: 0.8rem 0; }
		.no-data .no-data-con .van-button { font-size: 0.75rem; font-weight:400; color:rgba(1,195,39,1); }
		/* 店铺弹出框 */
		.van-popup { display: flex; flex-direction: column; }
		.van-popup .tit-con { height: 2.875rem; display: flex; align-items: center; text-align: center; }
		.van-popup .tit-con .text { flex: 1; font-size: 0.875rem; font-weight: bold;}
		.van-popup .tit-con .type { width: 4.6rem; font-size: 0.875rem; font-weight: bold;}
		.van-popup .shop-con { flex: 1; overflow-y: scroll;  }
		.van-popup .shop-con .shop-item { height: 2.875rem; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; text-align: center; padding: 0 0.75rem; }
		.van-popup .shop-con .shop-item .title { flex: 1;}
		.van-popup .btn-con { width: 100%; height: 55px; display: flex;}
        .van-popup .btn-con .van-button__text { color: #000; }
		/* 去使用弹窗 */
		.share-popup-con { width: 90%; background: transparent; }
		.share-popup-con .tit { position: absolute; top: 2.81%; left: 0; width: 100%; height: 16.6%; color: #c85002; font-size: 1.375rem; font-weight: bold;display: flex; align-items: center; justify-content: center; }
		.share-popup-con .imgcode-con { position: absolute;top: 22%; left: 0; width: 100%; height: 30%; display: flex; align-items: center; justify-content: center; }
		.share-popup-con .imgcode-con #imgcode { width: 60%; height: 100%; background: #000; }
		.share-popup-con .desc { position: absolute; top: 50%; left: 0; width: 100%; text-align: center; color:  rgba(75,75,75,0.5); font-size: 0.875rem;}
		.share-popup-con .btn-con { position: absolute; bottom: 14.45%;left: 6%; width: 88%; height: 10.71%; display: flex; align-items: center; justify-content: space-between; }
		.share-popup-con .btn-con .van-button { width: 46%; background: #fff; border: none; box-shadow: 0px 5px 5px 0px rgba(0,0,0,0.14); padding: 0; }
		.share-popup-con .btn-con .van-button .van-button__text{ color: #c85002; font-weight: bold;font-size: 1rem; }
		.share-mask {
			height: 100%;
			width: 100%;
			z-index: 20000;
			top: 0;
			left: 0;
			color: #fff;
			position: fixed;
			background: rgba(0, 0, 0, 0.8);
		}

		.share-mask-content p {
			padding-left: 20px;
			font-size: 28px;
			color: #fff
		}
		.img-show-con { width: 100%; height: 100%; background: transparent; }
		.img-show-con .img-con { position: absolute; top: 50%; width: 100%; transform: translateY(-50%); }
	</style> 

</head>

<body>
	<div id="app" :class="!isAction ? 'ucenter touch' : 'ucenter no-touch'" v-cloak>
		<!-- <van-sticky> -->
			<div class="top" id="top">
				<img class="bg" src="./images/receice-coupon.png" alt="">
				<div class="shop-info" :style="(tab1Index == 0 ? `background: url('./images/choose-bg1.png') no-repeat center/cover;` : `background: url('./images/choose-bg2.png') no-repeat center/cover;`)">
                    <div class="left-con" :style="tab1Index == 0 ? `width:53%` : `width:47%`"  @click="handleTab1Click(0)">
                        <template v-if="tab1Index == 0">
                            <img class="left-icon" src="./images/addr-icon.png" alt="">
                            <div class="shop-addr">
                                <div class="name">
                                    <span class="text">附近5公里店铺</span>
                                    <span style="display: flex; align-items: center;">
                                        <van-icon color="#4b4b4b" name="arrow-down" />
                                    </span>
                                </div>
                            </div>
                        </template>
                        <template v-else>
                            <span class="tab-text">附近5公里店铺</span>
                        </template>
                    </div>
                    <div class="right-con" :style="tab1Index == 0 ? `width:47%` : `width:53%`" @click="handleTab1Click(1)">
                        <template v-if="tab1Index == 0">
                            <span class="tab-text">已关注店铺</span>
                        </template>
                        <template v-else>
                            <img class="left-icon" src="./images/addr-icon.png" alt="">
                            <div class="shop-addr">
                                <div class="name">
                                    <span class="text">{{curShopName ? curShopName : '已关注店铺'}}</span>
                                    <span style="display: flex; align-items: center;">
                                        <van-icon color="#4b4b4b" name="arrow-down" />
                                    </span>
                                </div>
                                <div class="addr">{{curShopAddr ? curShopAddr : (shopList && shopList.length > 0 ? '点击选择关注店铺' : '暂无关注店铺')}}</div>
                            </div>
                        </template>
                    </div>
				</div>
			</div>
        <!-- </van-sticky> -->
		<div v-if="isShopUser" style="height: 40px;background: #fff;"></div>
		<div v-if="!isShopUser" style="height: 20px; background: #fff;"></div>
        <div class="pt-coupon-con" id="pt-coupon-con" @click="jump('getPlatCoupon.html')" v-if="isShopUser">
            <img class="pt-coupon-bg" src="./images/pt-yhq-bg.png" alt="" >
        </div>
        <van-tabs v-model="tab2Index" @change="handleTab2Click" class="tab2-con" :border="false" title-inactive-color="#888888" title-active-color="#333333" line-width="30px" line-height="5px">
            <van-tab title="全部优惠券" name="0"></van-tab>
            <van-tab title="已领取优惠券" name="1"></van-tab>
        </van-tabs>

		<!-- <div style="padding: 0 0.75rem;">
            <div :class="itm.can_get!=0?'unUsed list':'list'"  v-for="(itm,idx) in ShopCouponList"  v-if="ShopCouponList && ShopCouponList.length > 0">
                <div class="left">
                    <p><span>{{tab2Index == 0 ? (itm.type == 0 ? itm.money : itm.discount) : (itm.c_type == 0 ? itm.money : itm.discount)}}</span>{{tab2Index == 0 ? (itm.type == 0 ? '元' : '折') : (itm.c_type == 0 ? '元' : '折')}}</p>
                    <p class="juan-desc">{{itm.type_str}}</p>
                </div>
                <div class="right">
                    <div>
                        <p>{{itm.name}}<span>{{itm.target_str}}</span></p>
						<button  @click="receiveItem(itm,idx)" v-if="tab2Index == 0">{{itm.can_get == 0 ? '已领完' : (itm.can_get == 1 ? '点击领取' : '领取上限')}}</button>
						<button  @click="handleUse(itm)" v-if="tab2Index == 1">去使用</button>
                    </div>
                    <van-cell :title="'有效期至' + itm.end_time_str" value="规则详情" is-link arrow-direction="down"  @click.stop="detail(itm.coupon_id,itm.shop_id)"></van-cell>
                </div>
            </div>
		</div> -->
		<div style="padding: 0 0.75rem;">
			<div :class="tab2Index == 0 ? (item.can_get == 0 ? 'list-item bg3' : 'list-item bg1') : 'list-item bg2'" v-for="(item,index) in ShopCouponList" v-if="ShopCouponList && ShopCouponList.length > 0">
				<div class="left" @click.stop="detail(item.coupon_id,item.shop_id)">
					<div class="left-top">
						<div class="shop-logo">
							<img :src="item.logo" alt="">
						</div>
						<div class="shop-info">
							<div class="shop-tit">{{item.shop_name}}</div>
							<div class="coupon-tit">{{item.name}}</div>
						</div>
					</div>
					<div class="left-bot">
						<template v-if="tab2Index == 0 && item.can_get != 2">
							<div class="desc">剩余：{{item.left_num}}张</div>
							<div class="progress">
								<van-progress :percentage="item.percentage" color="#f22120" ></van-progress>
							</div>
						</template>
						<template v-else>
							<div class="coupon-desc">
								<div class="cell">
									<div class="cell-left">{{item.target_str}}</div>
									<div class="cell-right">{{'有效期至' + item.end_time_str}}</div>
								</div>
								<van-icon name="arrow" color="#888" size="14"></van-icon>	
							</div>
						</template>	
					</div>
				</div>
				<div :class="item.can_get == 0 ? 'right no-coupon' : 'right'" @click.stop="tab2Index == 0 ? receiveItem(item,index) : handleUse(item)">
					<div class="top">
						<span class="price">{{tab2Index == 0 ? (item.type == 0 ? item.money : item.discount) : (item.c_type == 0 ? item.money : item.discount)}}</span>
						<span class="price-icon">{{tab2Index == 0 ? (item.type == 0 ? '元' : '折') : (item.c_type == 0 ? '元' : '折')}}</span>
					</div>
					<div class="bot"  v-if="tab2Index == 0">{{item.can_get == 0 ? '已领完' : (item.can_get == 1 ? '点击领券' : '领取上限')}}</div>
					<div class="bot"  v-if="tab2Index == 1">去使用</div>
				</div>
				<img class="yhq-yl-icon" v-if="tab2Index == 1" src="./images/yhq-yl-icon.png" alt="">
				<img class="yhq-type" :src="tab2Index == 0 ? (item.type == 0 ? (item.can_get == 0 ? './images/manjian2.png' : './images/manjian1.png') : (item.can_get == 0 ? './images/zhekou2.png' : './images/zhekou1.png')) : (item.c_type == 0 ? (item.can_get == 0 ? './images/manjian2.png' : './images/manjian1.png') : (item.can_get == 0 ? './images/zhekou2.png' : './images/zhekou1.png'))" alt="">
			</div>
			<!-- <div class="list-item bg2">
				<div class="left">
					<div class="left-top">
						<div class="shop-logo">
							<img src="http://sy.xfd365.com/public/uploads/logo.jpg" alt="">
						</div>
						<div class="shop-info">
							<div class="shop-tit">益农信息社</div>
							<div class="coupon-tit">专属优惠券</div>
						</div>
					</div>
					<div class="left-bot">
						<div class="coupon-desc">
							<div class="cell">
								<div class="cell-left">使用门槛:满66可用</div>
								<div class="cell-right">有效期至2019.12.30</div>
							</div>
							<van-icon name="arrow" color="#888" size="14"></van-icon>	
						</div>
					</div>
				</div>
				<div class="right">
					<div class="top">
						<span class="price">5</span>
						<span class="price-icon">元</span>
					</div>
					<div class="bot">去使用</div>
				</div>
			</div>

			<div class="list-item bg3">
				<div class="left">
					<div class="left-top">
						<div class="shop-logo">
							<img src="http://sy.xfd365.com/public/uploads/logo.jpg" alt="">
						</div>
						<div class="shop-info">
							<div class="shop-tit">益农信息社</div>
							<div class="coupon-tit">专属优惠券</div>
						</div>
					</div>
					<div class="left-bot">
						<div class="coupon-desc">
							<div class="cell">
								<div class="cell-left">使用门槛:满66可用</div>
								<div class="cell-right">有效期至2019.12.30</div>
							</div>
							<van-icon name="arrow" color="#888" size="14"></van-icon>	
						</div>
					</div>
				</div>
				<div class="right no-coupon">
					<div class="top">
						<span class="price">5</span>
						<span class="price-icon">元</span>
					</div>
					<div class="bot">已领完</div>
				</div>
			</div> -->
		</div>
        <van-popup v-model="isAction" round position="bottom" :style="{ height: '60%' }" >
            <div class="tit-con">
                <span class="text">请选择店铺</span>
            </div>
            <div class="shop-con van-hairline--top">
                <div class="shop-item" v-for="item in shopList" @click="currentShop(item)">
                    <div class="title">{{item.shop_name}}</div>
                </div>
            </div>
            <div class="btn-con">
                <van-button style="width: 90%;margin-left: 5%;" color="#f6f6f6"  round block @click="isAction=false">取消</van-button>
            </div>
		</van-popup>
		<!-- <van-dialog v-model="dialogShow" title="扫码核销" :showConfirmButton="false" class="dialog-con">
			<div class="img-con">
				<img :src="qrcodeImg" id="imgcode"/>
			</div>
			<div class="btn-con">
				<van-button type="default" @click="jump('index.html?shop_id='+curDialogShopId)">去店铺</van-button>
				<van-button type="primary" @click="toShare()">去分享</van-button>
			</div>
		</van-dialog> -->
		<van-popup v-model="dialogShow" class="share-popup-con">
			<img src="./images/share-yhq-bg.png" width="100%" alt="">
			<div class="tit">
				优惠券条形码
			</div>
			<div class="imgcode-con" @click="imgShow = true" >
				<img :src="qrcodeImg" id="imgcode"/>
			</div>
			<div class="desc">
				请向店员出示
			</div>
			<div class="btn-con">
				<van-button type="primary" round @click="jump('speedBuy.html?shop_id='+curDialogShopId)">查看可用商品</van-button>
				<van-button type="primary" round  @click="toShare()">分享优惠券</van-button>
			</div>
		</van-popup>
		<van-popup v-model="imgShow" class="img-show-con" @click="imgShow = false">
			<div class="img-con">
				<img :src="qrcodeImg" width="100%" alt="">
			</div>
		</van-popup>



		<div class="full-loading" v-if="isFullLoading" style="z-index: 999;">
			<van-loading  color="#1989fa" /> 
		</div>
		<div class="no-data" id="noData1" v-if="(shopList.length === 0 || ShopCouponList.length === 0 || isErr) && !isFullLoading && (tab1Index == 0 ? (!locationCancel && !locationErr) : (tab1Index == 1))">
			<div class="no-data-con">
				<img :src="isErr ? errImg : noDataImg" alt="">
				<p class="no-title">{{ isErr ? '网络竟然崩溃了' : (tab1Index == 0 ? '暂无可领取优惠券' : (curShopId ? '暂无可领取优惠券' : '请先选择店铺') )}}</p>
				<p class="no-desc">{{ isErr ? '别紧张,试试看刷新页面' : (shopList.length == 0 ? '暂无关注的店铺' : ( tab1Index == 0 ?  (isAll ? (shopIdStr ? '附近5公里暂无可领取店铺,请尝试切换关注店铺' : '附近5公里暂无可用店铺优惠券') : '请尝试切换其他店铺获取优惠券') : '请尝试切换其他店铺获取优惠券')) }}</p>
			</div>
		</div>
		<div class="no-data" id="noData2" v-if="(locationCancel || locationErr) && !isFullLoading && tab1Index == 0">
			<div class="no-data-con">
				<img :src="errImg" alt="">
				<p class="no-title">{{ locationErr ? '获取定位失败' : '您已经取消定位' }}</p>
				<p class="no-desc">{{ locationErr ? '别紧张,请尝试重新定位' : '取消定位将无法获取优惠券信息' }}</p>
				<van-button size="small" plain round color="#01C327" @click="getLocation">重新定位</van-button>
			</div>
		</div>
		<div class="share-mask" v-show="isShare" @click="isShare = false">
			<div style="width:100%;height:80px;">
				<img style="display:block;position:fixed;right:10px;top:0px;width:80px;height:80px;"  src="images/icon/share.png" alt="">
			</div>
			<div class="share-mask-content">
			<p>点击右上角</p>
			<p>通过【发送给朋友】</p>
			<p>分享优惠券</p>
			</div>
		</div>
	</div>

	<script>
		
		var app = new Vue({
			el: '#app',
			data: {
                tab1Index: 0,
                tab2Index: '0',
				JumpUrl: {
					jssdkUrl: 'http://sy.xfd365.com/wx/jssdk2/getSignPackage',
					checkToken: 'http://sy.xfd365.com/wx/base/checkToken', //检查token
					token: 'http://sy.xfd365.com/wx/wechat/login', //微信登录
					my_shops: baseUrl('/wx/shop/my_shops'), // 获取关注的店铺
					// my_shops: 'http://172.168.0.50/wx/shop/my_shops',
					shop_coupon:  baseUrl('/wx/coupon/shop_coupon'), // 5公里内的店铺优惠券列表
					// shop_coupon: 'http://172.168.0.50/wx/coupon/shop_coupon', 
					coupon_list: baseUrl('/wx/coupon/coupon_list'), // 获取指定店铺优惠券
					// coupon_list: 'http://172.168.0.50/wx/coupon/coupon_list', // 获取指定店铺优惠券
					get_coupon: baseUrl('/wx/coupon/get_coupon'),
					// get_coupon:'http://172.168.0.50/wx/coupon/get_coupon',
					got_coupon: baseUrl('/wx/coupon/got_coupon'), // 领券平台已领取的优惠券
					// got_coupon:'http://172.168.0.50/wx/coupon/got_coupon',
					if_shop_owner: baseUrl('/wx/coupon/if_shop_owner'),
					shopInfo: baseUrl('/wx/shop/shop_info'),
				},
				
				token: localStorage.getItem("token"),
				shopList: [],
				ShopCouponList: [],
				isAll: true, // 判断是否是全部店铺
				isAction: false, // 选择店铺弹窗
				lng: '',
				lat: '',
				curShopName: '', //指定店铺名称
				curShopAddr: '', // 指定店铺地址
                curShopId: '', // 指定店铺Id
				noDataImg: './images/icon/no-goods.png',
				errImg: './images/err.png',
				isFullLoading: true,
				isErr: false,
				locationErr: true,
				locationCancel: true,
				code: '',
				shopIdStr: '',
				shopIdStr2: '',
				isShopUser: false,
				dialogShow: false,
				qrcodeImg: '',
				imgShow: false,
				curDialogShopId: '',
				source:'',
				curLockId: '',
				curShopInfo: '',
				cur_coupon_id: '',
				isShare: false
			},
			mounted() {
				   
			},
			methods: {	
				// 去使用 按钮
				handleUse(item){
					let that = this
					this.dialogShow = true
					this.curDialogShopId = item.shop_id
					this.curLockId = item.lock_id
					this.share_title = item.share_title
					this.share_content = item.share_content
					this.share_img = item.share_img
					this.getShopInfo(item.shop_id)
					this.cur_coupon_id = item.coupon_id
					setTimeout(() =>{
						JsBarcode("#imgcode", item.user_coupon_id+','+item.wechat_user_id, {
							text: ' ',
							margin:10,
						});
						setTimeout(() => {
							that.qrcodeImg = document.getElementById('imgcode').src
							
						});
						
					})
				},
				 // 获取店铺信息
				 getShopInfo(id) {
                    var that = this;
                    axios({
                        method: 'post',
                        url: that.JumpUrl.shopInfo,
                        data: {token: that.token, shop_id: id }			    	
                    }).then(function (resp) {
                            if(resp.data.errno == 0) {
                                that.curShopInfo = resp.data.data
                            }
                        }).catch(function (error) {
                            //请求失败

                        })
                },
				toShare() {
					let that = this;
					let shopInfo = that.curShopInfo;
					let share_title = that.share_title ? that.share_title : '恭喜您！获得一张优惠券~'
					let share_introduction = that.share_content ? that.share_content : '众多商品种类和优惠活动等你来拿  炎炎夏日送温情，优惠活动享不停!'
					let shop_id = shopInfo.id
					let logo = that.share_img ? that.share_img : shopInfo.logo
					that.isShare = true
					wx.ready(function () { //需在用户可能点击分享按钮前就先调用
						wx.updateAppMessageShareData({
							title: share_title, // 分享标题
							desc: share_introduction, // 分享描述
							// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							link: 'http://sy.xfd365.com/mobile/shareGetcoupon.html?shop_id='+shop_id +'&coupon_id=' + that.cur_coupon_id, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							imgUrl: logo, // 分享图标
							success: function () {

							}
						})

						wx.updateTimelineShareData({
							title: share_title, // 分享标题
							desc: share_introduction, // 分享描述
							// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							link: 'http://sy.xfd365.com/mobile/shareGetcoupon.html?shop_id='+shop_id +'&coupon_id=' + that.cur_coupon_id, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							imgUrl: logo, // 分享图标
							success: function () {}
						})
					});
				},
				// 判断是否为商家
				getShopUser() {
					let that = this;
					axios({
						method: 'post',
						url: that.JumpUrl.if_shop_owner,
						data: { token: that.token }
					})
					.then(function (resp) { //返回数据
						// resp.data = JSON.parse(resp.data)

						if(resp.data.code == 1) {
							if(Number(resp.data.data) > 0) {
								that.isShopUser = true
							}else {
								that.isShopUser = false
							}
						} else {
							that.isShopUser = false
						}
					}).catch(function (error) {
						that.isShopUser = false
						//请求失败
						console.log('error', error);

					})
				},
                // 切换附近五公里店铺与已关注店铺
                handleTab1Click(index) {
                    this.tab1Index = index
                    if(this.tab1Index == 0) {
						this.ShopCouponList = []
                        this.curShopName = '';
                        this.curShopAddr = '';
						this.curShopId = '';
                        if(!this.locationCancel && !this.locationErr) {
                            if(this.tab2Index == 0) {
								this.getShopCouponList();
							} else {
								if(this.shopIdStr2) {
									this.getCouponByShopId()
								}
							}
                        } else {
                            this.$toast('请重新获取定位！')
                        }
                    } else if(this.tab1Index == 1) {
						if(this.curShopId == '') {
							this.ShopCouponList = []
						}
						if(this.shopList.length == 0) {
							this.$toast('暂无关注的店铺!')
						}else {
							this.showShop()
						}
                    }
                },
                // 切换全部优惠券与已领取优惠券
                handleTab2Click(name,title) {
                    if(this.tab1Index == 0) {
						this.ShopCouponList = []
                        if(!this.locationCancel && !this.locationErr) {
                           if(this.tab2Index == 0) {
								this.getShopCouponList();
						   } else {
							   this.ShopCouponList = []
							   if(this.shopIdStr) {
									this.getCouponByShopId()
							   }
						   }
                        } else {
                            this.$toast('请重新获取定位！')
                        }
                    } else if(this.tab1Index == 1){
						this.ShopCouponList = []
						if(this.curShopId) {
							if(this.tab2Index == 0) {
								this.getCurShopCouponList(this.curShopId)
							}else {
								this.shopIdStr = this.curShopId
								this.getCouponByShopId()
							}
						} else {
							this.$toast('请先选择关注的店铺!')
						}
                    }
                    this.tab2Index = name
                },
				jump(path) {
					window.location.href = path
				},
				getUrlParam(name) {
					var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
					var r = window.location.search.substr(1).match(reg);
					if (r != null) return unescape(r[2]);
					return null;
				},
				wxSign: function () {
					var that = this;
					let back_url = 'http://sy.xfd365.com/mobile/getCoupon.html';
					axios({
							method: 'post',
							// url: 'https://api.xfd365.com/wx/wechat/get_jump_url',
							url: 'http://sy.xfd365.com/wx/wechat/get_jump_url',
							data: {
								back_url: back_url,
							}
						})
						.then(function (resp) {
							//返回数据
							window.location.href = resp.data.url;

						}).catch(function (error) {
							//请求失败
							console.log('error', error);
						})
				},
				wechatLogin: function () {
					var that = this;
					axios({
							method: 'post',
							url: that.JumpUrl.token,
							//data: form_data
							data: {
								code: that.code
							}
						})
						.then(function (resp) { //返回数据
							that.token = resp.data.token;
							localStorage.setItem('token', that.token);
							window.history.pushState(null, null,
									'http://sy.xfd365.com/mobile/getCoupon.html');
							if (that.token) {
								that.getJssdk();
							}

						}).catch(function (error) {
							//请求失败
							console.log('error', error);

						})

				},
				//检查token是否过期
				checkToken: function () {
					var that = this;
					axios({
							method: 'post',
							url: that.JumpUrl.checkToken,
							data: {
								token: that.token,
								shop_id: that.shop_id,
								from: that.gzh
							}

						})
						.then(function (resp) {
							//返回数据
							if (resp.data.errno == 1) {
								//token过期调用跳转页面方法
								localStorage.removeItem('token')
								localStorage.removeItem('shoper_token')
								that.wxSign();
							} else {
								that.getJssdk();
							}
						}).catch(function (error) {
							//请求失败
							console.log('error', error);

						})
				},
				// 根据id获取已领取优惠券
				getCouponByShopId() {
					let that = this;
					that.isAll = false
					that.isFullLoading = true;
					that.ShopCouponList = []
					if(that.tab1Index == 0 && that.tab2Index == 1) {
						that.shopIdStr = that.shopIdStr2
					}
					axios({
							method: 'post',
							url: that.JumpUrl.got_coupon,
							data:{shop_id_str: that.shopIdStr, token: that.token}
						})
						.then(function (resp) {
							that.isFullLoading = false
							that.isErr = false
							let data=resp.data
							if(data.code == 1){
								let tmpData = []
								if(data.data && data.data.length > 0) {
									data.data.forEach(item =>{
										item.end_time_str = item.user_coupon_age.split('-')[1]
										tmpData.push(item)
									})
									that.ShopCouponList = tmpData
								} else {
									that.ShopCouponList = []
								}
							}else{
								that.ShopCouponList = []	
							}
						}).catch(function (error) {
							that.isFullLoading = false
							that.isErr = true
							//请求失败
							that.$toast.fail('服务异常,请稍后重试!')
							console.log('error', error);
						})
				},
				// 获取关注的店铺
				getShopList() {
					var that = this;
					// that.isErr = false;
					// that.isFullLoading = true;
					axios({
							method: 'post',
							url: that.JumpUrl.my_shops,
							data: {
								token: that.token,
							}
						})
						.then(function (resp) {
							// that.isErr = false;
							// that.isFullLoading = false;
							if(resp.data.errno == 0) {
								if(resp.data.data && resp.data.data.length > 0) {
									that.shopList = resp.data.data;
									let shopId = that.getUrlParam('shopId')
									let tab1Index = that.getUrlParam('tab1Index')
									let tab2Index = that.getUrlParam('tab2Index')
									if(tab1Index == 0 || tab1Index == 1) {
										if(shopId) {
											that.getCurShopCouponList(shopId)
											resp.data.data.forEach(item =>{
												if(item.id == shopId) {
													that.curShopName = item.shop_name;
													that.curShopAddr = item.full_address;
												}
											})
											that.curShopId = shopId
											that.shopIdStr = shopId
										}
										that.tab1Index = tab1Index
										that.tab2Index = tab2Index
									}
									if(that.source == 'share') {
										window.history.pushState(null, null,
										'http://sy.xfd365.com/mobile/getCoupon.html');
									}
								} else {
									that.shopList = [];
								}
							}
							
						}).catch(function (error) {
							// that.isErr = true;
							// that.isFullLoading = false;
							//请求失败
							console.log('error', error);

						})
				},
				// 获取5公里店铺优惠券
				getShopCouponList() {
					let that = this;
					that.isAll = true
					that.isAction = false
					that.isFullLoading = true
					that.shopIdStr = ''
					axios({
							method: 'post',
							url: that.JumpUrl.shop_coupon,
							data:{lng:that.lng,lat:that.lat,token: that.token}
						})
						.then(function (resp) {
							that.isFullLoading = false
							that.isErr = false
							let data=resp.data
							if(data.code == 1){
								let tmpData = []
								if(data.data && data.data.length > 0) {
									data.data.forEach(item =>{
										item.end_time_str = item.coupon_age.split('-')[1]
										item.percentage = ((item.left_num/item.all)*100).toFixed(2)
										tmpData.push(item)
									})
									that.ShopCouponList = tmpData
								} else {
									that.ShopCouponList = []
								}
								that.shopIdStr = data.shop_id_str
								that.shopIdStr2 = data.shop_id_str
							}else{
								that.ShopCouponList = []
							}
						}).catch(function (error) {
							that.isFullLoading = false
							that.isErr = true
							//请求失败
							that.$toast.fail('服务异常,请稍后重试!')
							console.log('error', error);
						})
				},
				// 获取指定店铺优惠券
				getCurShopCouponList(id) {
					let that = this;
					that.isAll = false
					that.isFullLoading = true;
					that.ShopCouponList = []
					axios({
							method: 'post',
							url: that.JumpUrl.coupon_list,
							data:{tab_type: '0', shop_id: id, token: that.token}
						})
						.then(function (resp) {
							that.isFullLoading = false
							that.isErr = false
							let data=resp.data
							if(data.code == 1){
								let tmpData = []
								if(data.data && data.data.length > 0) {
									data.data.forEach(item =>{
										item.end_time_str = item.coupon_age.split('-')[1]
										// if(item.can_get == 1) {
											item.percentage = ((item.left_num/item.all)*100).toFixed(2)
											tmpData.push(item)
										// }
									})
									that.ShopCouponList = tmpData
								} else {
									that.ShopCouponList = []
								}
							}else{
								that.ShopCouponList = []	
								console.log(data.msg)
							}
						}).catch(function (error) {
							that.isFullLoading = false
							that.isErr = true
							//请求失败
							that.$toast.fail('服务异常,请稍后重试!')
							console.log('error', error);
						})
				},
				// 显示选择店铺弹出层
				showShop() {
					if(this.shopList && this.shopList.length > 0) {
						this.isAction = true
					} else {
						this.$toast('暂无关注的店铺')
					}
				},
				// 选择指定店铺
				currentShop(item) {
					this.curShopName = item.shop_name
					this.curShopAddr = item.full_address
                    this.curShopId = item.id
					if(this.tab2Index == 0) {
						this.getCurShopCouponList(item.id)
					}else {
						this.shopIdStr = this.curShopId
						this.getCouponByShopId()
					}
					this.isAction = false
				},
				// 领取优惠券
				receiveItem(item,index) {
					if(item.can_get == 0) return
					if(item.can_get == 2) {
						this.$toast('领取次数已达上限')
						return
					}
					let that = this
					if(item.can_get == 1) {
						if(that.get_coupon) return
						that.get_coupon = true
						axios({
							method: 'post',
							url: that.JumpUrl.get_coupon,
							data:{coupon_id: item.coupon_id, shop_id: item.shop_id, token: that.token}
						})
						.then(function (resp) {
							that.get_coupon = false
							let data=resp.data
							if(data.code == 1){
								that.$toast('领取成功')
								if(that.tab1Index == 0) {
									that.getShopCouponList()
								} else {
									that.getCurShopCouponList(item.shop_id)
								}
							}else if(data.code == 2){
								that.$dialog.alert({
									title: '提示',
									message: '只有益农卡会员才可以领取',
									showCancelButton: true,
									confirmButtonText: '加入会员'
								}).then(() =>{
									window.location.href = 'openVip.html?source=getcoupon'
									let obj = {
										tab1Index: this.tab1Index,
										tab2Index: this.tab2Index,
										shopList: this.shopList,
										ShopCouponList:this.ShopCouponList,
										isAll: this.isAll, // 判断是否是全部店铺
										isAction: false, // 选择店铺弹窗
										lng: this.lng,
										lat: this.lat,
										curShopName: this.curShopName, //指定店铺名称
										curShopAddr: this.curShopAddr, // 指定店铺地址
										curShopId: this.curShopId, // 指定店铺Id
										isFullLoading: false,
										isErr: false,
										locationErr: this.locationErr,
										locationCancel: this.locationCancel,
										shopIdStr: this.shopIdStr,
										shopIdStr2: this.shopIdStr2,
										isShopUser: this.isShopUser,
									}

									localStorage.setItem('getCouponData',JSON.stringify(obj))
									return
								}) .catch(() => {});
							} else {
								that.$toast.fail(data.msg ? data.msg : '获取失败')
							}

						}).catch(function (error) {
							that.get_coupon = false
							that.$toast.fail('服务异常,请稍后重试!')
							console.log('error', error);

						})
					}
				},
				// 优惠券详情
				detail(id,shopId) {
					window.location.href = 'couponDetail.html?id='+ id 
					let obj = {
						tab1Index: this.tab1Index,
						tab2Index: this.tab2Index,
						shopList: this.shopList,
						ShopCouponList:this.ShopCouponList,
						isAll: this.isAll, // 判断是否是全部店铺
						isAction: false, // 选择店铺弹窗
						lng: this.lng,
						lat: this.lat,
						curShopName: this.curShopName, //指定店铺名称
						curShopAddr: this.curShopAddr, // 指定店铺地址
						curShopId: this.curShopId, // 指定店铺Id
						isFullLoading: false,
						isErr: false,
						locationErr: this.locationErr,
						locationCancel: this.locationCancel,
						shopIdStr: this.shopIdStr,
						shopIdStr2: this.shopIdStr2,
						isShopUser: this.isShopUser,
					}

					localStorage.setItem('getCouponData',JSON.stringify(obj))
					return
					if(this.isAll) {
						window.location.href = 'couponDetail.html?id='+ id 
					} else {
						window.location.href = "couponDetail.html?tab1Index=" + this.tab1Index + '&tab2Index=' + this.tab2Index + '&id='+ id + '&shopId=' + shopId+ '&source=getCoupon';
					}
				},

				getJssdk: function () {
					let that = this;
					axios({
						method: 'post',
						url: that.JumpUrl.jssdkUrl,
						//data: form_data
						data: {
							token: that.token,
							url: window.location.href
						}
					}).then(function (resp) {
						let data = resp.data

						let sdkData = resp.data
						wx.config({
							debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
							appId: sdkData.appId, // 必填，公众号的唯一标识
							timestamp: sdkData.timestamp, // 必填，生成签名的时间戳
							nonceStr: sdkData.nonceStr, // 必填，生成签名的随机串
							signature: sdkData.signature, // 必填，签名
							jsApiList: [
								'getLocation',
								'updateAppMessageShareData',
								'updateTimelineShareData',
							] // 必填，需要使用的JS接口列表
						});
						if(that.source == 'share') {
							that.getShopList();
						} else {
							that.getShopUser()
							that.getLocation()
							that.getShopList();
						}
						
					})
				},
                getLocation() {
					let that = this;
					that.isFullLoading = true
                    wx.ready(function () {  
						wx.getLocation({
							type: 'gcj02',
							success: function (res) {
								that.locationErr = false
								that.locationCancel = false
								var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
								var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
								var speed = res.speed; // 速度，以米/每秒计
								var accuracy = res.accuracy; // 位置精度
								that.lng = longitude
								that.lat = latitude
								let tab1Index = that.getUrlParam('tab1Index')
								let tab12ndex = that.getUrlParam('tab2Index')
								if(tab1Index || tab1Index == 0 || tab12ndex || tab12ndex == 0) {
									that.locationErr = false
									that.locationCancel = false
									that.isFullLoading = false
								} else {
									that.getShopCouponList();
								}
							// 	that.$nextTick(function(){
							// 		let topH = document.getElementById('top').clientHeight
							// 		let couponBgH = document.getElementById('pt-coupon-con').clientHeight
							// 		let noData =  document.getElementById('noData1')
							// 		noData.style.top = topH + couponBgH + 84 + 'px'
							//      })   
								
							},
							fail: function (err) {
								that.locationErr = true
								that.locationCancel = false
								that.isFullLoading = false
								console.log(err)
								// that.$toast('获取定位失败,请升级最新微信版本');
							// 	that.$nextTick(function(){
							// 		let topH = document.getElementById('top').clientHeight
							// 		let couponBgH = document.getElementById('pt-coupon-con').clientHeight
							// 		let noData2 = document.getElementById('noData2')
							// 		noData2.style.top = topH + couponBgH +  84 + 'px'
							//      })
							},
							cancel: function (res) {
								that.locationErr = false
								that.locationCancel = true
								that.isFullLoading = false
								// that.$toast('取消定位,获取附近5公里优惠券！');
							// 	that.$nextTick(function(){
							// 		let topH = document.getElementById('top').clientHeight
							// 		let couponBgH = document.getElementById('pt-coupon-con').clientHeight
							// 		let noData2 = document.getElementById('noData2')
							// 		noData2.style.top = topH + couponBgH +  84 + 'px'
							//      }) 
							}
						});
						
						}); 
					// wx.error(function (res) {
					// 	console.log(res)
					// 	that.locationErr = true
					// 	that.$toast('获取定位失败,请升级最新微信版本');
					// 	//打印错误消息。及把 debug:false,设置为debug:ture就可以直接在网页上看到弹出的错误提示
					// });
				},
				initData() {
					let local = localStorage.getItem('getCouponData')
					let data = JSON.parse(local)
					this.tab1Index = data.tab1Index,
					this.tab2Index = data.tab2Index,
					this.shopList = data.shopList,
					this.ShopCouponList = data.ShopCouponList,
					this.isAll = data.isAll, // 判断是否是全部店铺
					this.isAction = false, // 选择店铺弹窗
					this.lng = data.lng,
					this.lat = data.lat,
					this.curShopName = data.curShopName, //指定店铺名称
					this.curShopAddr = data.curShopAddr, // 指定店铺地址
					this.curShopId = data.curShopId, // 指定店铺Id
					this.isFullLoading = false,
					this.isErr = false,
					this.locationErr = data.locationErr,
					this.locationCancel = data.locationCancel,
					this.shopIdStr = data.shopIdStr,
					this.shopIdStr2 = data.shopIdStr2,
					this.isShopUser = data.isShopUser,
					localStorage.removeItem('getCouponData')
				}
				


			},
			created: function () {
				let local = localStorage.getItem('getCouponData')
				let source = localStorage.getItem('source')
				this.source = source
				if(source == 'share') {
					let code = getQueryString('code');
					if (code) {
						this.code = code;
					}
					let token = localStorage.getItem('token')
					if (this.code) {
						this.wechatLogin()
					} else {
						if (token) {
							this.checkToken()
						} else {
							this.wxSign()
						}
					}
					return
				}
				localStorage.removeItem('source2')
				if(local) {
					this.initData()
				} else {
					let code = getQueryString('code');
					if (code) {
						this.code = code;
					}
					let token = localStorage.getItem('token')
					if (this.code) {
						this.wechatLogin()
					} else {
						if (token) {
							this.checkToken()
						} else {
							this.wxSign()
						}
					}
				}
				
			}
		})
	</script>
</body>

</html>