<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />

	<title>聚农优享</title>
	<meta name="viewport"
		content="width=device-width,initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
	<!-- 	<link rel="stylesheet" type="text/css" href="./css/aui.css" /> -->
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/public.css">
	<link rel="stylesheet" href="css/index.css">

	<script src="./js/rem.js"></script>
	<script src="./js/vue.js"></script>
	<script src="js/index.js"></script>
	<script src="js/axios.min.js"></script>
	<script src="js/vue-resource.js"></script>
	<script type="text/javascript" src="js/publick.js?v=3"></script>
	<script type="text/javascript" src="./js/api.js"></script>
	<script type="text/javascript" src="./js/jweixin-1.4.0.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.5.9/lib/index.css">
	<script src="https://cdn.jsdelivr.net/npm/vant@2.5.9/lib/vant.min.js"></script>
	<style>
		[v-cloak] {
			display: none;
		}
        /* 导航栏 */
        .van-nav-bar .van-icon { color: #333; font-size: 0.35rem; }
        .van-nav-bar .van-nav-bar__right { position: absolute; top: 50%; transform: translateY(-50%); }
        .van-nav-bar .van-nav-bar__right img { display: block; }
        .van-nav-bar .van-nav-bar__title { font-weight: bold; }
        /* 通知栏 */
        .notice-con { padding: 8px 10px; text-align: center; background: #fff2f0; font-size: 0.26rem; }
        .notice-con .tit { font-weight: bold; padding-bottom: 5px; }
        .notice-con .yxq { color: #999; }
        /*图标导航*/
		.nav { display: flex; flex-wrap: nowrap; justify-content: flex-start; align-content: space-between; padding-top: 0.24rem; margin-top: 10px; padding: 0 2%; width: 95%; overflow-x: auto; overflow-y: hidden; white-space: nowrap; }
        .nav img { width: 1.2rem; height: 1.2rem; margin-bottom: 10px; border: 2px solid transparent; }
        .nav li { text-align: center; font-size: 0.24rem; color: #444; margin: 0.14rem; width: 16%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .nav li.active img { border: 2px solid #02CF0A; border-radius: 50%; }
        .nav li.active span { color: #fff; background: #00BE34; border-radius: 20px; padding: 4px; }
        .nav li a { display: flex; flex-direction: column; align-items: center; }
        .van-sticky--fixed { background: #fff; }
		/* 商品列表 */
		.goods-con  {  background: transparent; position: relative; min-height: 4.5rem;padding-top: 10px; padding-bottom: 10px; }
		.goods-con .van-grid-item .van-grid-item__content { border-radius: 8px; height: auto!important; justify-content: inherit;box-shadow:0 0 8px rgba(0,0,0,.1) }
		.goods-con .van-grid-item__icon-wrapper { width: 100%; height: calc(50vw - 31px); }
		.goods-con .no-sale { position: absolute; top: 50%; left: 50%;background: rgba(0,0,0,0.6); transform: translate(-50%,-50%);width: 1rem; height: 0.48rem; border-radius: 4px; color: #fff; font-size: 0.24rem; text-align: center; line-height: 0.48rem; }
		.goods-con .goods-title { font-size: 0.26rem; font-weight: bold; width: calc(50vw - 31px); height: 20px;overflow: hidden;text-overflow: ellipsis; white-space: nowrap; margin-top: 6px;}
		.goods-con .goods-spec { width: 100%; font-size: 0.24rem;margin-top: 6px;color: #888;width: calc(50vw - 31px); height: 20px;overflow: hidden;text-overflow: ellipsis; white-space: nowrap; }
		.goods-con .price-con { width: calc(50vw - 31px); display: flex; align-items: center; justify-content: space-between; overflow: hidden; }
		.goods-con .price-con .left-con { width: calc(50vw - 31px); overflow: hidden;  }
		.goods-con .price-con .left-con .price-cell { width: 100%; display: flex; align-items: center;flex-direction: column; }
		.goods-con .price-con .left-con .price-cell .price { font-size: 0.32rem; font-weight: bold; color: #fa193f;height: 30px;line-height: 30px; overflow: hidden; text-overflow: ellipsis; width: 100%;white-space: nowrap; }
		.goods-con .price-con .left-con .price-cell .price .price-icon { font-size: 0.28rem; }
		.goods-con .price-con .left-con .price-cell .price .unit { color: #888; font-size: 0.26rem; font-weight: 400; }
		.goods-con .price-con .left-con .price-cell .price2 { font-size: 0.28rem; color: #888; text-decoration: line-through; overflow: hidden; text-overflow: ellipsis; width: 100%;white-space: nowrap;}
		/* 无数据 */
		.no-data { position: fixed; top: 5rem; left: 0; right: 0; bottom: 0; }
		.no-data .no-data-con { position: absolute;  width: 90%; top: 50%; left: 50%; transform: translate(-50%,-50%); text-align: center; }
		.no-data .no-data-con img { width: 100%; }
		.no-data .no-data-con .no-title{ font-size: 0.32rem; font-weight:600;  color:rgba(0,0,0,1);  }
		.no-data .no-data-con .no-desc { font-size: 0.24rem; font-weight:400; color:rgba(136,136,136,1); padding: 0.8rem 0; }
	</style>
</head>

<body>
	<div id="app" v-cloak>
        <van-nav-bar :border="false" :fixed="true" :placeholder="true" z-index="9999" title="分销券可用商品" left-arrow @click-left="toRouter()" > </van-nav-bar>
        <div class="notice-con" v-if="couponDetail">
            <div class="tit">{{couponDetail.target_str}}</div>
            <div class="yxq">{{couponDetail.use_coupon_age}}</div>
        </div>
        <van-sticky :offset-top="46">
            <div class="fenlei"  id="searchBar">
				<ul class="nav">
					<li :class="{'active':curr==0}" @click="handleClick('',0)">
						<img src="images/more.png" alt="" width="20" />
						<span>全部</span>
					</li>
					<li :class="{'active':curr==index+1}" v-for="(item, index) in good_cates"
                    @click="handleClick(item.cate_id,index)">
						<img :src="item.icon?item.icon:'images/nav5.png'" alt="">
						<span>{{item.cate_name}}</span>
					</li>
                </ul>
            </div>
        </van-sticky>
		<van-list v-model="loading" :immediate-check="false" :finished="finished" @load="goodsList" :finished-text="goods_list.length > 0 ? '没有更多了' : ''" >
			<van-grid :column-num="2" :gutter="10" class="goods-con">
				<van-grid-item  v-for="(item, index) in goods_list">
					<template #icon>
						<van-image @click="details(item.goods_id, item.spcifi_name)" width="100%" height="100%" fit="contain" :style="item.storage <= 0 ? 'opacity:0.4': ''" :src="item.thumb ? item.thumb : 'http://sy.xfd365.com/public/uploads/exp.jpg'"></van-image>
						<div class="no-sale" v-if="item.storage <= 0">已售罄</div>
					</template>
					<template #text>
						<div class="goods-title" :style="item.storage <= 0 ? 'opacity:0.6': ''">{{item.goods_name}}</div>
						<div class="goods-spec" :style="item.storage <= 0 ? 'opacity:0.6': ''">{{item.spcifi_name_new}}</div>
						<div class="price-con">
							<div class="left-con" :style="item.storage <= 0 ? 'opacity:0.6': ''">
								<div class="price-cell" v-if="item.promotion_price && item.num <=(item.promotion_num-item.has_buy)">
									<span class="price" v-if="item.unit"><span class="price-icon">￥</span>{{item.promotion_price}}<span class="unit">/{{item.unit}}</span></span>
									<span class="price" v-else><span class="price-icon">￥</span>{{item.promotion_price}}</span>
									<span class="price2" v-if="item.unit"><span class="price-icon"></span>{{item.promotion_price}}<span class="unit">/{{item.unit}}</span></span>
									<span class="price2" v-else><span class="price-icon">￥</span>{{item.promotion_price}}</span>
								</div>
								<div class="price-cell" v-else>
									<span  class="price" v-if="item.unit"><span class="price-icon">￥</span>{{item.retail_price}}<span class="unit">/{{item.unit}}</span></span>
									<span class="price"	 v-else><span class="price-icon">￥</span>{{item.retail_price}}</span>
								</div>
							</div>
							<div class="right-con">
								<span v-if="item.storage <= 0" style="display: block; border: none;font-size: 0.24rem;width: 0.42rem;height: 0.42rem; background-image: url(images/icon/shouqin.png);background-size: 100% 100%;margin-bottom: 5px;"></span>
								<div v-if="item.num == 0 && item.storage!=0 "
									style="display: flex;justify-content: flex-end;margin-bottom: 5px;">
									<img src="images/jiagou.png" alt="" style="width: 0.42rem;height: 0.42rem;"
										@click="addG(index,item.goods_id,item.spcifi_id, item.promotion_num, item.has_buy, item.storage)">
                                </div>
                                <div v-if="item.num > 0 && item.storage>0" style="display: flex;justify-content: flex-end;">
                                    <img src="./images/speedBuy/jian.png" alt="" class="fl" style="width: 0.42rem;height: 0.42rem;"
                                        @click="reduceChange(item.goods_id,item.spcifi_id,item.num, index)">
                                    <div class="fl" style="margin-left: 5px;margin-right: 5px;margin-top: 2px;max-width: 20px; overflow: hidden; overflow-x: auto;">{{item.num}}</div>
                                    <img src="./images/jiagou.png" alt="" class="fl" style="width: 0.42rem;height: 0.42rem;"
                                        @click="addChange(item.goods_id,item.spcifi_id,item.promotion_num, item.has_buy, item.storage)">
                                </div>
							</div>
						</div>
					</template>
				</van-grid-item>
			</van-grid>
		</van-list>
		<div class="no-data" v-if="isErr || (goods_list.length == 0  && !loading && !isErr) || isNoData">
			<div class="no-data-con">
				<img src="./images/no-search.png" alt="">
				<p class="no-title">{{isErr ? '网络竟然崩溃了' : (isNoData ? '优惠券不存在' : '该分类下暂无可用商品')}}</p>
                <p class="no-desc">{{isErr ? '别紧张,试试看刷新页面' : (isNoData ? '' : '去其他分类看看吧吧')}}</p>
                <van-button size="small" plain round color="#01C327" v-if="isErr || isNoData" @click="handleErr">{{isErr ? '刷新' : '返回领券中心'}}</van-button>
			</div>
        </div>
        <div style="height: 60px;"></div>

        <van-tabbar v-model="tabbarIndex" active-color="#04C03A">
            <van-tabbar-item >
                <template #icon>
                    <img src="images/icon/sy2.png" width="18px" alt="">
                </template>
                首页
            </van-tabbar-item>
            <van-tabbar-item  :badge="count > 0 ? count : null"  @click="toShopCart">
                <template #icon>
                    <img src="images/icon/gwc1.png" width="18px" alt="">
                </template>
                购物车
            </van-tabbar-item>
            <van-tabbar-item @click="toPersonal">
                <template #icon >
                    <img src="images/icon/grzx.png" width="18px" alt="">
                </template>
                我的
            </van-tabbar-item>
        </van-tabbar>
	</div>
	<script>
		var app = new Vue({
			el: '#app',
			data: {
                tabbarIndex:0,
				goods_name: '',
                goods_list: [],
                good_cates: [], //商品分类
                curr: 0,
				JumpUrl: {
                    list: baseUrl('/wx/distribution/coupon_goods'),
                    cates: baseUrl('/wx/distribution/distribution_coupon_category'),
                    coupon_detail: baseUrl('/wx/coupon/coupon_detail'),
                    new_cart: baseUrl('/wx/distribution/new_cart'),
                    add: baseUrl('/wx/distribution/new_add'),
					jssdkUrl: 'http://sy.xfd365.com/wx/jssdk/getSignPackage',
				},
				page: 0,
				loading: false,
				finished: false,
				isErr: false,
				isNoData: false,

                cartList: [],
				addGoods: {
					goods_id: '',
					addGoodsspcifi_id: 0,
                    number: 0,
                    coupon_id: '',
					token: localStorage.getItem("token"),
				},
				count: 0,
				coupon_id: '',
				user_coupon_id: '',
                coupon_target_str: '',
                coupon_yxq: '',
                lastCateId: '',
                couponDetail: '',
                token: localStorage.getItem('token'),
			},

			methods: {
                toRouter() {
					let from = localStorage.getItem('disFrom')
					if(from == 'getShopCoupon') {
						window.location.href = 'getShopCoupon.html'
					} else if (from == 'myCoupon'){
						window.location.href = 'myCoupon.html'
					} else if (from == 'scanDestroy'){
						window.location.href = 'scanDestroy.html'
					}
                },
                // 跳转购物车
                toShopCart() {
                    window.location.href = 'disShoppingCart.html?coupon_id='+this.coupon_id +'&user_coupon_id='+this.user_coupon_id
				},
				// 跳转个人中心
				toPersonal() {
					window.location.href = 'disPersonal.html?coupon_id='+this.coupon_id +'&user_coupon_id='+this.user_coupon_id
				},
                // 删除上个页面存储数据
                removeLocal() {
                    localStorage.removeItem('getCouponData')
                    localStorage.removeItem('myCouponToDetail')
                    localStorage.removeItem('myCouponList')
                },
				//商品详情
				details(id) {
					window.location.href = 'disGoodsDetail.html?id=' + id+'&coupon_id='+this.coupon_id+'&user_coupon_id='+this.user_coupon_id+'&v=1'
				},
                handleErr() {
					if(this.isErr) {
						this.goodsList()
					} else if(this.isNoData) {
						this.toRouter()
					}
                },
                // 获取商品分类
                getGoodCates() {
                    let that = this;
                    axios({
                        method: 'post',
                        url: that.JumpUrl.cates,
                        data: {
                            token: localStorage.getItem('token'),
                            coupon_id: that.coupon_id,
							user_coupon_id: that.user_coupon_id
                        }
                    })
                    .then(function(resp) {
                        if(resp.data.errno == 0) {
                            that.good_cates = resp.data.data.categoryList
                        } else {
                            that.good_cates = []
                        }
                        
                    }).catch(function(error) {
                        that.good_cates = []
                        //请求失败
                        console.log('error', error);
                    })
                },
				//首页获取商品列表
				goodsList() {
					var that = this;
					let page = this.page + 1
					that.isErr = false 
					that.isNoData = false
					if (page !== 1) {
						that.loading = true
					}
					axios({
                        method: 'post',
                        url: that.JumpUrl.list,
                        data: {
                            token: localStorage.getItem('token'),
                            page: page,
                            coupon_id: that.coupon_id,
							user_coupon_id: that.user_coupon_id,
                            order: 'dsc',
                            sort: 'sales_num',
                            goods_name: '',
                            size: '10',
                            cate_id: that.cate_id ? that.cate_id : ''
                        }
                    })
                    .then(function(resp) {
                        that.isErr = false 
                        that.loading = false
                        if (resp.data.code == 1) {
                            let resultData = resp.data.data.data;
                            if(resultData.length == 0) {
                                that.finished = true
								return
                            }
                            if (resultData) {
                                let cartList = that.cartList
                                for (var i = 0; i < resp.data.data.data.length; i++) {
                                    resp.data.data.data[i].num = 0;
                                    for (var j = 0; j < cartList.length; j++) {
                                        if (cartList[j].goods_id == resp.data.data.data[i].goods_id &&
                                            cartList[j].spcifi_id == resp.data.data.data[i].spcifi_id) {
                                            resp.data.data.data[i].num = cartList[j].number;
                                        }
                                    }
                                };

                                that.goods_list = that.goods_list.concat(resultData)
								if(page == 1) {
									that.myCart()
								}
                            }
                            that.page = page
                        } else {
                            that.loading = false
                            that.finished = true
							that.$toast.fail(resp.data.errmsg)
							if(resp.data.errmsg == '优惠券不存在') {
								that.isNoData = true
							}
                        }
                        
                    }).catch(function(error) {
                        that.isErr = true
                        that.loading = false
                        //请求失败
                        console.log('error', error);
                    })

                },
                //获取购物车内容
				myCart() {
					let that = this;
					let form_data = new FormData();
					makeFormData(that.addGoods, form_data);
					axios({
							method: 'post',
							url: that.JumpUrl.new_cart,
							data: form_data
						})
						.then(function (resp) {
							that.cartList = resp.data.data.cartList;
							that.count = resp.data.data.cartTotal.checkedGoodsCount;
							// console.log(that.cartList)
						}).catch(function (error) {
							//请求失败
							console.log('error', error);

						})
                },
                // 添加购物车
                addG(index, goods_id, spcifi_id, promotion_num, has_buy, storage) {
					let that = this;
					let canBuyName = promotion_num - has_buy;
					let carNum = 0;
					let cartList = that.cartList
					cartList.forEach(function (ele) {
						if (ele.goods_id == goods_id && ele.spcifi_id == spcifi_id) {
							carNum = ele.number;
						}
					})
					if (carNum >= storage) {
                        that.$toast('库存不足')
						return
					} else {
						if ((promotion_num == has_buy || carNum == canBuyName) && has_buy != -1) {
							that.$toast('每人限购' + promotion_num + '件，超出数量将按原价累加')
						}
						that.i = index;
						that.addGoods.goods_id = goods_id;
						that.addGoods.spcifi_id = spcifi_id;
						that.addGoods.number = 1;
						that.addCart(-1);
					}
                },
                //增加商品
				addChange(goods_id, spcifi_id, promotion_num, has_buy, storage) {
					var that = this;
					let canBuyName = promotion_num - has_buy;
					let carNum = 0;
					let cartList = that.cartList
					cartList.forEach(function (ele) {
						if (ele.goods_id == goods_id && ele.spcifi_id == spcifi_id) {
							carNum = ele.number;
						}
					})

					if (carNum >= storage) {
						that.$toast('库存不足')
						return;
					} else {
						if ((promotion_num == has_buy || carNum == canBuyName) && has_buy != -1) {
							that.$toast('每人限购' + promotion_num + '件，超出数量将按原价累加')
						}
						that.addGoods.goods_id = goods_id
						that.addGoods.spcifi_id = spcifi_id
						that.addGoods.number = 1;
						that.addCart();
					}

				},
                //减去商品
				reduceChange(goods_id, spcifi_id, num, index) {
					var that = this;
					that.addGoods.goods_id = goods_id;
					that.addGoods.spcifi_id = spcifi_id;
					that.addGoods.number = -1;

					if (num < 1) {
						return;
						that.addGoods.number = 0
					} else {
						that.addCart(index);
						that.addGoods.number = -1;
					}
					let goods_list = that.goods_list
					if (that.cartList.length == 0) {
						that.flag = 1;
						goods_list.forEach(function (ele) {
							ele.num = 0
						})
					} else {
						let ids = []
						that.cartList.forEach(item =>{
							if(item.goods_id == goods_list[index].goods_id) {
								ids.push(item.goods_id)
							}
						})
						if(ids.indexOf(goods_list[index].goods_id) > -1) {
							if(num <= 1) {
								goods_list[index].num = 0
							}
						}
					}
				},
                //添加商品/wx/cart/add
				addCart(index) {
					let that = this;
					if (that.box == 2) {
						return
					}
					that.box = 2;
					axios({
                        method: 'post',
                        url: that.JumpUrl.add,
                        data: that.addGoods
                    })
                    .then(function (resp) {
                        that.box = 1;
                        if (resp.data.errno === 0) {
                            that.count = resp.data.data.cartTotal.checkedGoodsCount; //总共几件
                            that.cartList = resp.data.data.cartList;
                            for (var i = 0; i < that.cartList.length; i++) {
                                for (var j = 0; j < that.goods_list.length; j++) {
                                    if (that.cartList[i].goods_id == that.goods_list[j].goods_id && that.cartList[i].spcifi_id == that.goods_list[j].spcifi_id) {
                                        that.goods_list[j].num = that.cartList[i].number;
                                        if (that.goods_list[j].num < 0) {
                                            that.goods_list[j].num = 0;
                                        }
                                    } 
                                }

                            }
                        } else {
                            that.$toast(resp.data.errmsg)
                        }
                    }).catch(function (error) {
                        //请求失败
                        console.log('error', error);
                    })
				},
                // 获取 优惠券详情
                getCouponDetail() {
                    var that = this;
			    	axios({
			    		method: 'post',
			    		url: that.JumpUrl.coupon_detail,
			    		data: { coupon_id: that.coupon_id, user_coupon_id: that.user_coupon_id, token: that.token }			    	})
			    	.then(function (resp) {
                        if(resp.data.code == 1) {
							if(resp.data.data.target_limit == 0) {
								resp.data.data.target_str = '无门槛使用'
							} else {
								resp.data.data.target_str = '使用门槛:满'+ resp.data.data.target+'元可使用'
							}
                            that.couponDetail = resp.data.data
							if(!localStorage.getItem('disCouponDetail')) {
								localStorage.setItem('disCouponDetail',JSON.stringify(that.couponDetail))
							}
							that.setWx(); 
                        } else {
                            that.$toast.fail(resp.data.msg ? resp.data.msg : '获取失败!')
                        }   

			    	}).catch(function (error) {
						//请求失败
                        that.$toast.fail('服务异常,请稍后重试!')
						console.log('error', error);
					})
                },
                // 切换分类
				handleClick(id, index) {
                    var that = this
                    if(that.lastCateId == id) return
                    that.cate_id = id;
                    that.lastCateId = id;
					that.goods_list = []
					that.page = 0;
                    that.curr = id ? (index + 1) : '';
                    that.loading = true;
                    that.finished = false;
					that.goodsList()
				},
				checkPhone() {
					var _this = this
					var agent = (navigator.userAgent || navigator.vendor || window.opera)
					if (agent != null) {
						var agentName = agent.toLowerCase()
						if (/android/i.test(agentName)) {
							return 'android'
						} else if (/iphone/i.test(agentName)) {
							return 'ios'
						}
					}
				},
				getJssdk() {
					let that = this;
					axios({
						method: 'post',
						url: that.JumpUrl.jssdkUrl,
						//data: form_data
						data: {
							token: localStorage.getItem('token'),
							url: encodeURIComponent(location.href.split('#')[0])
						}
					}).then(function(resp) {
						let sdkData = resp.data
						// console.log(sdkData, 'sdkData')
						// console.log(sdkData.signature, 'sig')
						wx.config({
							debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
							appId: sdkData.appId, // 必填，公众号的唯一标识
							timestamp: sdkData.timestamp, // 必填，生成签名的时间戳
							nonceStr: sdkData.nonceStr, // 必填，生成签名的随机串
							signature: sdkData.signature, // 必填，签名
							jsApiList: [
								'updateAppMessageShareData',
								'updateTimelineShareData',
							] // 必填，需要使用的JS接口列表
						});
						that.getCouponDetail()
						that.getGoodCates();
					})
				},
				setWx() {
					let that = this;
					let share_title = that.couponDetail.name
					let share_introduction = '前往领券中心领取优惠券'
					let logo = that.couponDetail.share_img
					wx.ready(function() { //需在用户可能点击分享按钮前就先调用
						wx.updateAppMessageShareData({
							title: share_title, // 分享标题
							desc: share_introduction, // 分享描述
							// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							link: 'http://sy.xfd365.com/mobile/getShopCoupon.html', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							imgUrl: logo, // 分享图标
							success: function() {
				
							}
						})
						wx.updateTimelineShareData({
							title: share_title, // 分享标题
							desc: share_introduction, // 分享描述
							// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							link: 'http://sy.xfd365.com/mobile/getShopCoupon.html', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							imgUrl: logo, // 分享图标
							success: function() {
							}
						})
					});
				},
			},
			mounted() {
				let that = this
				let coupon_id = getQueryString('coupon_id')
				let user_coupon_id = getQueryString('user_coupon_id')
				let phoneType = that.checkPhone()
				that.coupon_id = coupon_id
				that.user_coupon_id = user_coupon_id
				that.addGoods.coupon_id = coupon_id
				that.addGoods.user_coupon_id = user_coupon_id

				// 监听页面关闭事件
				// if(phoneType == 'android'){
				// 	window.onunload = function () {
				// 		that.removeLocal()
				// 	}
				// } else if(phoneType == 'ios') {
				// 	window.addEventListener('pagehide', function () {
				// 		that.removeLocal()
				// 	});
				// }
				that.getJssdk()
				that.goodsList();
			}
         
		})
	</script>
</body>

</html>