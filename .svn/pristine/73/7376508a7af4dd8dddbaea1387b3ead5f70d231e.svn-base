<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>聚农优享</title>
		<meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/public.css">
		<link rel="stylesheet" href="font/font_560087_tt31urijhi307ldi/iconfont.css">
		<!-- <link rel="stylesheet" href="css//index.css"> -->
		<link rel="stylesheet" href="css/index.css" />
		<link rel="stylesheet" type="text/css" href="./css/aui.css" />
		<script src="./js/vue.js"></script>
		<script src="js/index.js"></script>
		<script src="js/axios.min.js"></script>
		<script type="text/javascript" src="js/publick.js?v=3"></script>
		<script type="text/javascript" src="./js/jweixin-1.4.0.js"></script>

		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.5/lib/index.css">

		<!-- 引入 Vue 和 Vant 的 JS 文件 -->
		<!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script> -->
		<script src="https://cdn.jsdelivr.net/npm/vant@2.5/lib/vant.min.js"></script>

		<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.4/dist/html2canvas.min.js"></script>

		<style>
			[v-cloak] {
				display: none;
			}

			img {
				vertical-align: top;
			}

			.xz {
				font-size: 0.7rem;
				margin-right: 5px;
			}

			.el-tabs__nav-wrap::after {
				height: 0px;
			}

			.el-tabs__item {
				color: #fff;
				font-size: 16px;
			}

			.textTitle {
				width: 80%;
				height: auto;
				word-wrap: break-word;
				word-break: break-all;
				overflow: hidden;
				font-size: 1.18rem;
				font-weight: bold;
			}

			.goodspp {
				padding: 10px;
				font-size: 14px;
			}

			.goodsyj p {
				margin-left: 10px;
				color: #999;
				font-size: 0.6rem;

			}

			.aui-list-item-arrow {
				color: #212121;
				font: 14px/1.5 "微软雅黑", tahoma, arial, \5b8b\4f53;
			}

			.wholeSee {
				color: #f36065 !important;
			}

			.pj .aui-list-item-arrow:before {
				width: 0;
				height: 0;
			}

			.aui-margin-b-15 {
				margin-bottom: 0 !important;
			}

			.aui-bar {
				position: fixed;
				bottom: 0;
				right: 0;
				left: 0;
				z-index: 10;
				width: 100%;
				min-height: 2.25rem;
				font-size: 14px;
				text-align: center;
				display: table;
			}

			.el-dialog__header {
				padding: 0;
			}

			.el-dialog__body {
				padding: 0px 0px;
				position: relative;
			}

			.el-dialog {
				position: fixed;
				bottom: 0px;
				margin: 0 auto;
			}

			.aui-btn-danger {
				background-color: #fa8972 !important;
			}

			.aui-btn-danger.aui-active,
			.aui-btn-danger:active {
				color: #ffffff !important;
				background-color: #fa8972 !important;
			}

			.el-row {
				position: fixed;
			}
			

			.share-mask {
				height: 100%;
				width: 100%;
				z-index: 20000;
				top: 0;
				left: 0;
				color: #fff;
				position: fixed;
				background: rgba(0, 0, 0, 0.8);
			}

			.share-mask-content p {
				padding-left: 20px;
				font-size: 28px;
				color: #fff
			}

			.specsDiv {
				margin-top: 15px;
			}

			.specsDiv li {
				margin-right: 10px;
				margin-top: 10px;
				padding: 0 5px;
				border-radius: 5px;
				background-color: #EEEEEE
			}

			.specsDiv li.active {
				color: #fa8972;
				background: rgba(250, 137, 114, 0.16);
			}

			.specsDiv li.unable {
				color: #d0d0d0;
			}

			.selectCont {
				color: #333333;
				padding: 10px 0 0 50px;
				position: relative;
			}

			.selectCont span {
				position: absolute;
				left: 0;
				top: 10px;
			}


			

			.price {
				font-size: 30px;
				height: 60px;
				line-height: 60px;
			}

			.share-mask-img .el-dialog {
				position: static;
				border-radius: 10px;
				background: transparent;
				box-shadow: none;
			}

			.share-mask-img .el-dialog__body {
				padding: 0;
			}

			.share-mask-img .el-dialog__body img {
				margin: 0 auto;
				background: transparent;
				border-bottom-left-radius: 5px;
				border-bottom-right-radius: 5px;
			}

			.share-mask-img .shareBtn {
				color: #FFFFFF;
				width: 100%;
				text-align: center;
				margin: 10px auto 0 auto;
				border-radius: 30px;
				line-height: 40px;
				background: linear-gradient(#51d35e, #00c859);
			}

			.share-mask-img .shareBtn img {
				display: inline-flex;
				margin: 11px 2px 0 0;
				width: 18px;
			}
			.share-mask-img .shareInfo{
				margin-top: 5px;
				color: #ffffff;
				text-align: center;
			}

			.share-close {
				position: fixed;
				right: 8%;
				top: 8%;
				color: #EEEEEE;
			}
			.share-close.el-icon-circle-close:before{
				font-size: 26px;
			}

			.share-cont {
				background: #FFFFFF;
				position: relative;
				width: 90%;
				margin: 0 5%;
				border-top-left-radius: 10px;
				border-top-right-radius: 10px;
				text-align: center;
			}

			.share-cont .top {
				margin: 0 auto;
				padding: 10px 0 5px 0;
			}

			.share-cont .main-title {
				font-size: 20px;
				text-align: center;
				font-weight: bold;
				color: #4a4a4a;
				letter-spacing: 2px;
			}

			.share-cont .child-title {
				font-size: 15px;
				text-align: center;
				color: #8e8e8e;
				letter-spacing: 2px;
			}

			.share-cont .goodImg {
				margin: 0 auto;
				padding: 10px 20px 0 20px;
				border-radius: 5px;
				max-height: 200px;
			}

			.bottom-cont {
				position: relative;
				background: url(images/share_bottom.png) no-repeat top center;
				background-size: 100% auto;
				display: flex;
				align-items: center;
				width: 100%;
				padding: 30px 20px 0 20px;
				margin-top: -10px;
			}

			.bottom-cont .left {
				flex: 1;
			}

			.bottom-cont img {
				width: 80px;
				height: 80px;
			}

			.bottom-cont .left .title {
				font-size: 15px;
				color: #353535;
				font-weight: bold;
			}

			.bottom-cont .left .price {
				height: 32px;
				line-height: 32px;
			}

			.bottom-cont .left .price .tip {
				font-size: 11px;
				color: #FFFFFF;
				padding: 2px 3px;
				border-radius: 5px;
				background: linear-gradient(90deg, #FF1A1A 0%, #FF5E00 100%);
			}

			.bottom-cont .left .price .price {
				color: #ff2814;
				font-size: 22px;
				font-weight: bold;
			}

			.bottom-cont .left .price .unit-money {
				color: #FF2814;
				font-size: 13px;
				font-weight: bold;
			}

			.bottom-cont .left .price .unit {
				color: #6D6D6D;
				font-size: 13px;
			}

			.bottom-cont .left .price .old-price {
				font-size: 10px;
				color: #9B9B9B;
				text-decoration: line-through;
			}
			/* .bottom-cont .left .keyword-con {
				margin-top: 10px;
			} */

			.bottom-cont .left .keyword {
				font-size: 11px;
				border-radius: 15px;
				padding: 0 5px;
				margin-top: 8px;
				display: inline-block;
			}

			.bottom-cont .left .keyword:first-child {
				color: #FF4465;
				border: 1px solid #FF4465;
			}

			.bottom-cont .left .keyword:last-child {
				color: #888888;
				border: 1px solid #dfdfdf;
			}
			html,body { font-size: 16px; }
			@media all and (max-width:375px) {
				body,html{
					font-size: 14px;
				}
			}
			@media only screen and (min-width: 414px) {
				body,html {
					font-size: 16px !important;
				}
			}
			@media only screen and (min-width: 480px) {
				body,html {
					font-size: 22px !important;
				}
			}
			/* 导航栏 */
			.van-nav-bar .van-icon { color: #333; font-size: 1.1rem; }
			.van-nav-bar .van-nav-bar__right { position: absolute; top: 50%; transform: translateY(-50%); }
			.van-nav-bar .van-nav-bar__right img { display: block; }
			.van-nav-bar .van-nav-bar__title { font-weight: bold; }
			.bg-white { background: #fff; }
			/* 视频封面 */
			.cover-con { width: 100%; height: 100%; background: rgba(0, 0, 0, 0.2); }
			.player-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 20%; }
			/* 商品介绍 */
			.goodspp .share-poster { display: flex; width: 2.5rem; height: 2.5rem; border-radius: 50%; text-align: center;font-size: 0.625rem; flex-direction: column;align-items: center;justify-content: center;box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.24); }
			.goodspp .el-icon-share { font-size: 0.875rem; }
			.choose-spec { margin: 0 0.625rem; background: #fff; border-radius: 10px; height: 46px; line-height: 46px; padding: 0 10px; padding-right: 30px; align-items: center; font-size: 0.875rem; position: relative; overflow: hidden;  }
			.choose-spec .title { color: #888; margin-right: 0.3rem }
			.choose-spec .value { margin-right: 0.3rem; }
			.choose-spec .van-icon-arrow { position: absolute; top: 50%; right: 16px; transform: translateY(-50%); color: #888; }

			/* 配送距离 */
			.left-tips { display: flex; align-items: center; margin-right: 10px; }
			.left-tips span { margin-left: 5px; }

			.notify-yhq-con { margin: 0 0.625rem;   margin-top: 0.625rem; border-radius: 10px; box-sizing: border-box;}
			.notify-yhq { background: #fff8f7; border-radius: 10px; }
			.notify-yhq .van-cell__title { margin-left: 0.5rem; font-size: 0.875rem; color: #333; }
			.notify-yhq .van-cell__value { font-size: 0.65rem; color: #888888; }
			.notify-yhq .van-icon { font-size: 0.875rem; color: #999999; }
			/* 商品详情 */
			.goods-info { margin: 0.625rem; border-radius: 10px; overflow: hidden;}
			.goods-info >p:first-of-type { height: 2.2rem; font-size: 0.875rem; color: #4b4b4b; font-weight: bold; display: flex; justify-content: center; align-items: center; background: #fff; }
			.goods-info >p:first-of-type img { width: 15px; height: 15px; margin: 0 10px; }
			.goods-info >p:first-of-type img:last-of-type { transform: rotate(180deg); }
			.goods-info .goods_content { background: #fff; padding: 0 0.75rem; word-break: break-word; font-size: 0.875rem;}
			.goods-info .goods_content p { font-size: 0.875rem;  }
			.goods-info .goods_content img { padding: 10px; display: block; margin: 0 auto; max-width: 100%; }
			.goods-info .goods_content p video { width: 100%; }
			.goods-info .goods_content p video::-webkit-media-controls-mute-button { display: none !important;}
			.goods-info .goods_content p video::-internal-media-controls-overflow-button{ display: none !important;}
			/* .goods-info .goods_content p video::-webkit-media-controls-timeline { display: none !important; } */
			.goods-info .goods_content p video::-webkit-media-controls-current-time-display{ display: none !important; }
			.goods-info .goods_content p video::-webkit-media-controls-time-remaining-display { display: none !important; }
			.goods-info .goods_content p video::-webkit-media-controls-toggle-closed-captions-button { display: none !important; }
			.goods-info .goods_content p video::-webkit-media-controls-volume-slider { display: none !important; }
			/* 选择规格弹窗 */
			.choose-spec-popup .van-card { background: #fff; padding-top: 16px; }
			.choose-spec-popup .van-card .van-card__header .van-card__thumb { width: 5.6rem; height: 5.6rem; }
			.choose-spec-popup .van-card .van-card__header .van-card__content .price { font-size: 1.125rem; color: #ff2814; font-weight:bold;height: auto; line-height: initial; }
			.choose-spec-popup .van-card .van-card__header .van-card__content .line-price { font-size: 0.75rem; color: #b2b2b2; text-decoration: line-through; }
			.choose-spec-popup .van-card .van-card__header .van-card__content .desc { display: flex; flex-direction: column; font-size: 0.75rem; color: #b2b2b2; padding: 0.5rem 0; }
			.choose-spec-popup .van-card .van-card__header .van-card__content .desc .xian-gou { font-size: 0.875rem; color: #ff2814; font-weight: bold; }
			.choose-spec-popup .product-content { padding: 8px 16px }
			.choose-spec-popup .product-content .product-delcom { margin-bottom: 10px; }
			.choose-spec-popup .product-content .product-delcom p { font-size: 0.875rem; color: #353535; }
			.choose-spec-popup .product-content .product-delcom .product-footerlist li {  border-radius: 4px; color: #333; text-align: center; padding: 5px 10px; float: left; margin-top: 10px; margin-right: 20px; cursor: pointer; background: #f9f9f9; font-size: 0.75rem; }
			.choose-spec-popup .product-content .product-delcom .product-footerlist li.productActive { background-color: #1A1A29; color: #fff; }
			.choose-spec-popup .product-content .product-delcom .product-footerlist li.noneActive { background-color: #ccc; opacity: 0.4; color: #000; pointer-events: none; }
			.choose-spec-popup .spec-no { padding: 16px; display: flex; align-items: center }
			.choose-spec-popup .spec-no .title { font-size: 1rem; margin-right: 0.3rem; }
			.choose-spec-popup .spec-no .value { font-size: 0.875rem; color: #999; }
			.choose-spec-popup .pay-num-con { display: flex; padding: 8px 16px; align-items: center; justify-content: space-between; }
			.choose-spec-popup .pay-num-con span { flex: 1 }
			.choose-spec-popup .pay-num-con .step-con { display:flex; align-items: center; justify-content: center; }
			.choose-spec-popup .footer-btn { position: fixed; bottom: 16px; left: 0; width: 100%; height: 3rem; padding: 0 16px}
			.choose-spec-popup .footer-btn .btn { width: 100%; height: 100%; color: #fff; background: linear-gradient(#02cf0a, #00be34); border-radius: 1000px; font-size: 1rem; line-height: 3rem; text-align: center; }
			/* 底部 */
			.group-goods-action .van-button__text { display: flex; flex-direction: column; height: 2.5rem; margin: 0; padding: 0.3rem 0; }
			.group-goods-action .van-button__text .price-con { display: flex; align-items: center; font-size: 0.75rem; height: 0.95rem; padding: 0; align-items: center; justify-content: center; overflow: hidden; }
			.group-goods-action .van-button__text .price-con .price { font-size: 0.875rem; font-weight: bold; }
			.group-goods-action .van-button__text .price-con .price-icon { font-size: 0.75rem; }
			.group-goods-action .van-button__text .buy-type { display: flex;height: 0.95rem; align-items: center;font-size: 0.75rem; justify-content: center; overflow: hidden; }
		</style>

	</head>
	<body>
		<div id="app" v-cloak>
			<van-nav-bar :border="false" :fixed="true" :placeholder="true" z-index="9999" title="商品详情" left-arrow @click-left="returnLast()">
				<template #right>
					<img src="images/icon/shouye.png" alt="" width="20"  @click="JumpIndex">
				</template>
			</van-nav-bar>
			<!-- 图片轮播 -->
			<van-swipe style="height: 18.75rem;">
				<van-swipe-item  v-if="info.thumb && videoUrl">
					<div class="cover-con" @click.stop="playVideo">
						<img :src="info.thumb" style="width:100%;height: 100%;">
					</div>
					<img class="player-icon" @click.stop="playVideo" src="images/player-icon.png" alt="">
				</van-swipe-item>
				<van-swipe-item v-if="info.thumb && !videoUrl">
					<a href="javascript:;">
						<img :src="info.thumb" style="width:100%;height: 100%;">
					</a>
				</van-swipe-item>
				<van-swipe-item v-for="(item, index) in info.album" :key="index">
					<a href="javascript:;">
						<img :src="item" style="width:100%;height: 100%;">
					</a>
				</van-swipe-item>
			</van-swipe>
			<!-- 配送范围 -->
			<template v-if="extent">
				<van-notice-bar :text="extent">
					<template #left-icon>
						<div class="left-tips">
							<img src="images/icon/jingshi.png" alt="" width="18" height="18">
							<span>配送范围</span>
						</div>
					</template>
				</van-notice-bar>
			</template>
			<!-- 商品介绍 -->
			<div style="background-color: #fff; margin: 0.625rem;border-radius:10px">
				<div class="clearfix goodspp">
					<div class="fl">
						<span class="textTitle">{{info.goods_name}}</span>
					</div>
					<!-- <div class="fr share-poster" @click="shareImg()">
						<span class="el-icon-share"></span>
						<span>海报</span>
					</div> -->
				</div>
				<div v-if="decPrice > 0" style="padding: 0 10px;color: red;font-weight: bold;">每人限购{{promotion_num}}件</div>
				<div class="clearfix goodspp">
					<div class="fl" v-if="decPrice > 0">
						<span style="color: #f36065;font-weight:700" v-if="info.unit">￥{{decPrice}}/{{info.unit}} </span>
						<span style="color: #f36065;font-weight:700" v-else>￥{{decPrice}}</span>

						<span style="color: gray;text-decoration: line-through;font-size: 12px;" v-if="info.unit">￥{{price}}/{{info.unit}}
						</span>
						<span style="color: gray;text-decoration: line-through;font-size: 12px;" v-else>￥{{price}}</span>
					</div>
					<div class="fl" v-else>
						<span style="color: #f36065;font-weight:700" v-if="info.unit">￥{{price}}/{{info.unit}} </span>
						<span style="color: #f36065;font-weight:700" v-else>￥{{price}}</span>
					</div>
					<div class="fr" style="padding:0 5px;margin-right:10px;background: #eee;border-radius: 10px;">
						<span v-if="salesShow==1"> 销量{{info.sales_num}}{{info.unit}} </span>
					</div>
				</div>
			</div>
			<div class="choose-spec"  @click="joinGoods">
				<span class="title">选择</span>
				<span class="value" v-if="spcifiList && spcifiList[0].name">{{spcifiList[0].name}}</span>
				<span class="value" v-if="spcifiList && spcifiList[1].name">{{spcifiList[1].name}}</span>
				<span class="value" v-if="spcifiList && spcifiList[2].name">{{spcifiList[2].name}}</span>
				<van-icon name="arrow" ></van-icon>
			</div>

			<!-- 商品详情 -->
			<div class="goods-info">
				<p> <img src="./images/spxx_left.png" alt=""> 商品信息 <img src="./images/spxx_left.png" alt=""></p>
				<div class="goods_content" v-html="info.content"></div>
			</div>
			<!-- 底部 -->
			<div style="height: 60px;"></div>
			<van-goods-action>
				<van-goods-action-icon icon="chat-o" text="客服"  ></van-goods-action-icon>
				<van-goods-action-icon icon="cart-o" text="购物车" @click="jump('disShoppingCart.html')" ></van-goods-action-icon>
				<van-goods-action-icon icon="shop-o" text="店铺" @click="jump('disCouponGoods.html')" ></van-goods-action-icon>
				
				<van-goods-action-button color="linear-gradient(#e5f9e7, #d9f7e7)" style="color: #09c959;font-weight: bold;font-size: 0.875rem;" type="warning" text="加入购物车" @click="joinGoods"></van-goods-action-button>
				<van-goods-action-button color="linear-gradient(#00be34, #02cf0a)"  style="font-weight: bold;font-size: 0.875rem;" type="danger" text="立即购买" @click="atOnce()"></van-goods-action-button>
			</van-goods-action>

			<div @click="shareGoods()" class="share-mask" v-show="isShare">
				<div style="width:100%;height:80px;">
					<img style="display:block;position:fixed;right:10px;top:0px;width:80px;height:80px;" src="images/icon/share.png"
					 alt="">
				</div>
				<div class="share-mask-content">
					<p>点击右上角</p>
					<p>通过【发送给朋友】</p>
					<p>邀请好友购买</p>
				</div>
			</div>
			<!-- <div id="newImg"> -->
			<!-- 必须设置成fixed，不然滚动的时候生成的海报图片是记录有滚动高度，始终有偏移距离 -->
			<div id="newImg" style="position: fixed;width: 100%;top: -1000px;background:transparent">
			<!-- <div style="position: fixed; top: 0; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.8);">
				<div id="newImg" style="position: absolute;width: 100%;top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 999;"> -->
				<div class="share-cont">
					<img src="images/share_top%208.png" class="top" />
					<p class="main-title">好物分享</p>
					<p class="child-title">美好事物,都分享给你!</p>
					<img :src="thumbImgBase"  class="goodImg"  />
					<!-- <img src="images/a6.png" class="goodImg" /> -->
						
				</div>
				<div style="background: #ffffff;">
					<div class="bottom-cont">
						<div class="left">
							<p class="title">{{info.goods_name}}</p>
							<p class="price" v-if="decPrice > 0">
									<span class="tip">惊爆价</span>
									<span class="unit-money">¥</span><span class="price">{{decPrice}}</span><span class="unit" v-if="info.unit">/{{info.unit}}</span>
									<span class="old-price">¥{{price}}</span></p>
							<p class="price" v-else>
									<span class="tip">惊爆价</span>
									<span class="unit-money">¥</span><span class="price">{{price}}</span><span class="unit" v-if="info.unit">/{{info.unit}}</span></p>
								</p>
							<p class="keyword-con"><span class="keyword">限时促销</span>
									<!-- <span class="keyword">24小时发货</span></p> -->
						</div>
						<!-- <img src="pao/static/img/fanyong.7ed8107.png" /> -->
						<img :src="qrcode" />
					</div>
					<!-- </div> -->
					<p style="width: 100%;height: 20px;"></p> <!-- 站位底部留白  -->
				</div>
				
			</div>
			<van-popup v-model="dialogFormVisible" position="bottom" closeable close-icon="close" round :style="simulatedDATA.specifications.length == 3 ? { height: '75%' } : (simulatedDATA.specifications.length == 2 ? { height: '65%' } : { height: '55%' })" class="choose-spec-popup" >
				<van-card :thumb="showImg ? showImg : 'http://sy.xfd365.com/public/uploads/exp.jpg'" class="van-hairline--bottom" >
					<template #title>
						<div class="price">
							<template v-if="decPrice > 0">
								<span>￥{{decPrice}}</span>
								<span class="line-price">￥{{price}}</span>
							</template>
							<template v-else>
								<span>￥{{price}}</span>
							</template>
						</div>
					</template>
					<template #desc>
						<div class="desc">
							<span  v-if="decPrice > 0" class="xian-gou">每人限购{{promotion_num}}件</span>
							<span>库存 {{storage}}</span>
						</div>
					</template>
					<template #price>
						<div class="choose-info">
							<span  v-if="simulatedDATA.difference.length > 0">选择规格</span>
							<span v-if="simulatedDATA.difference.length == 0">{{info.spec}}</span>
						</div>
					</template>
				</van-card>
				<div class="product-content" v-if="simulatedDATA.difference.length > 0">
					<div class="product-delcom" v-for="(ProductItem,n) in simulatedDATA.specifications">
						<p>{{ProductItem.name}}</p>
						<ul class="product-footerlist clearfix">
							<li v-for="(oItem,index) in ProductItem.item" v-on:click="specificationBtn(oItem.name,n,$event,index)"
								v-bind:class="[oItem.isShow?'':'noneActive',subIndex[n] == index?'productActive':'']">
								{{oItem.name}}
							</li>
						</ul>
					</div>
				</div>
				<div  v-if="simulatedDATA.difference.length == 0" class="spec-no">
					<span class="title">规格</span>
					<span class="value">{{info.spec}}</span>
				</div>
				<div class="pay-num-con">
					<span>购买数量</span>
					<div class="step-con">
						<img src="./images/speedBuy/jian.png" alt="" class="fl" width="22px" @click="reduceChange()">
						<div class="fl" style="margin-left: 20px;margin-right: 20px;height:22px;line-height: 22px;">{{amount}}</div>
						<img src="./images/speedBuy/jia.png" alt="" class="fl" width="22px" @click="addChange(info.goods_id, spcifi_id)">
					</div>
				</div>

				<div class="footer-btn">
					<div class="btn" @click="joinCart(info.goods_id)">{{gouwu}}</div>
				</div>
				<div style="height: 4rem;"></div>
			</van-popup>
			<el-dialog title="" :visible.sync="dialogShareVisible" center width="90%" :show-close="false" class="share-mask-img">
				<!-- <img src="images/close.png" class="share-close" @click="dialogShareVisible = false" /> -->
				<i class="el-icon-circle-close share-close" @click="dialogShareVisible = false"></i>
				<img :src="testsrn" />
				<div class="shareBtn" @click="shareGoods()"><img src="images/friend.png">分享至朋友圈</div>
				<p class="shareInfo">长按图片发送好友或保存</p>
			</el-dialog>
			<div class="page-mask" v-show="loading">
				<div class="page-mask-content">
					<div class="el-loading-spinner"><i class="el-icon-loading"></i>
						<p class="el-loading-text">拼命加载中</p>
					</div>
				</div>
			</div>
		</div>
		<script>
			var app = new Vue({
				el: '#app',
				data: {
					loading: 0,
					dialogFormVisible: false, //加入购物车
					gouwu: '加入购物车',
					amount: 1,
					JumpUrl: {
						jssdkUrl: 'http://sy.xfd365.com/wx/jssdk/getSignPackage',
						checkToken: 'http://sy.xfd365.com/wx/base/checkToken',
						loginUrl: 'http://sy.xfd365.com/wx/wechat/login',

						detail: baseUrl('/wx/goods/detailTest'),
						add: baseUrl('/wx/distribution/new_add'),
						index: baseUrl('/wx/cart/new_cart'),
						coupon_detail: baseUrl('/wx/coupon/coupon_detail'),
						getDistributionScope: baseUrl('/wx/address/get_shop_distribution'),
					},
					goodsXq: {
						goods_id: '',
						spcifi_id: 0, // 商品规格id,没有规格可为0
						token: localStorage.getItem("token"),
						number: 1,
						is_now: '',
						coupon_id: '',
						user_coupon_id: '',
					},
					goods_id: '',
					switch: '',
					info: {

					}, //获取商品信息
					isShare: false,
					token: '',
					salesShow: 0,
					cate_id: '',
					tabIndex: 0,
					goodsPage: '',
					scrollTop: '',
					goodId: '',
					addGoods: {
						goods_id: '',
						spcifi_id: 0,
						coupon_id: '',
						number: 0,
						token: localStorage.getItem("token"),
					},
					count: 0,
					cartList: [],
					isAble: true,
					isActive: true,
					simulatedDATA: { //模拟后台返回的数据 多规格
						"difference": [],
						"specifications": []
					},
					selectArr: [], //存放被选中的值
					shopItemInfo: {}, //存放要和选中的值进行匹配的数据
					subIndex: [], //是否选中 因为不确定是多规格还是单规格，所以这里定义数组来判断
					price: '', //选中规格的价钱
					decPrice: '', // 促销价格
					decSavePrce: '', // 保存促销价格（无规格）
					storage: 0, // 库存
					showImg: '', //图片
					spcifi_id: 0,
					promotion_num: '',
					has_buy: '',
					dialogShareVisible: false,
					qrcode: '',
					thumbImg: '',
					thumbImgBase: '',
					testsrn: '',
					spcifiList: [],
					isPlay: false,
					playUrl: '',
					videoUrl: '',
					coupon_id: '',
					user_coupon_id: '',
					extent: '',
				},
				methods: {
					// 播放视频
					playVideo() {
						this.isPlay = true
						this.playUrl = window.location.href
						window.location.href = this.videoUrl
					},
					specificationBtn(item, n, event, index) {
						var self = this;
						self.amount = 1 // 重置数量
						if (self.selectArr[n] != item) {
							self.selectArr[n] = item;
							self.subIndex[n] = index;
						} else {
							self.selectArr[n] = "";
							self.subIndex[n] = -1; //去掉选中的颜色
						}
						self.checkItem();
					},
					checkItem() {
						var self = this;
						var option = self.simulatedDATA.specifications;
						var result = []; //定义数组储存被选中的值
						for (var i in option) {
							result[i] = self.selectArr[i] ? self.selectArr[i] : '';
						}
						for (var i in option) {
							var last = result[i]; //把选中的值存放到字符串last去
							for (var k in option[i].item) {
								result[i] = option[i].item[k].name; //赋值，存在直接覆盖，不存在往里面添加name值
								option[i].item[k].isShow = self.isMay(result); //在数据里面添加字段isShow来判断是否可以选择
							}
							result[i] = last; //还原，目的是记录点下去那个值，避免下一次执行循环时被覆盖
						}
						if (this.shopItemInfo[result]) {
							this.price = this.shopItemInfo[result].retail_price
							this.decPrice = this.shopItemInfo[result].promotion_price
							this.spcifi_id = this.shopItemInfo[result].spcifi_id
							// this.storage = this.shopItemInfo[result].storage || ''
							this.storage = this.shopItemInfo[result].storage
							this.showImg = this.shopItemInfo[result].pic
							this.promotion_num = this.shopItemInfo[result].promotion_num
							this.has_buy = this.shopItemInfo[result].has_buy
						}
						self.$forceUpdate(); //重绘

					},
					// 页面跳转
					jump(url) {
						window.location.href = url+'?coupon_id='+this.coupon_id+'&user_coupon_id='+this.user_coupon_id;
					},
					isMay(result) {
						for (var i in result) {
							if (result[i] == '') {
								return true; //如果数组里有为空的值，那直接返回true
							}
						}
						if (this.shopItemInfo[result]) {
							return this.shopItemInfo[result].storage == 0 ? false : true; //匹配选中的数据的库存，若不为空返回true反之返回false
						} else {
							return false
						}

					},
					//检查token是否过期
					checkToken() {
						var that = this;
						axios({
								method: 'post',
								url: that.JumpUrl.checkToken,
								data: {
									token: that.token
								}
							})
							.then(function(resp) {
								//返回数据
								if (resp.data.errno == 1) {
									//token过期调用跳转页面方法
									localStorage.removeItem('token')
									that.wxSign();
								} else {
									that.getJssdk();
								}
							}).catch(function(error) {
								//请求失败
								console.log('error', error);

							})
					},
					//获取配送范围
					rangeDelivery() {
						let that = this;
						axios({
								method: 'post',
								url: that.JumpUrl.getDistributionScope,
								data: {token: localStorage.getItem('token')}
							})
							.then(function (resp) {
								if(resp.data.errno == 0) {
									if(resp.data.data.address && resp.data.data.distance && resp.data.data.distance != 0) {
										that.extent = resp.data.data.address+' '+ resp.data.data.distance+'公里之内'
									}
								}

							}).catch(function (error) {
								//请求失败
								console.log('error', error);

							})
					},
					setWx() {
						let that = this;
						let share_title = that.couponDetail.name
						let share_introduction = '前往领券中心领取优惠券'
						let logo = that.couponDetail.share_img
						wx.ready(function () { //需在用户可能点击分享按钮前就先调用
							wx.updateAppMessageShareData({
								title: share_title, // 分享标题
								desc: share_introduction, // 分享描述
								// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
								link: 'http://sy.xfd365.com/mobile/getShopCoupon.html',  // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
								imgUrl: logo, // 分享图标
								success: function () {

								}
							})
							wx.updateTimelineShareData({
								title: share_title, // 分享标题
								desc: share_introduction, // 分享描述
								// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
								link: 'http://sy.xfd365.com/mobile/getShopCoupon.html',  // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
								imgUrl: logo, // 分享图标
								success: function () {}
							})
						});
					},
					getJssdk() {
						let that = this;
						axios({
							method: 'post',
							url: that.JumpUrl.jssdkUrl,
							//data: form_data
							data: {
								token: localStorage.getItem('token'),
								url: window.location.href
							}
						}).then(function(resp) {
							// console.log(resp)
							let data = resp.data

							let sdkData = resp.data
							// console.log(sdkData, 'sdkData')
							// console.log(sdkData.signature, 'sig')
							wx.config({
								debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
								appId: sdkData.appId, // 必填，公众号的唯一标识
								timestamp: sdkData.timestamp, // 必填，生成签名的时间戳
								nonceStr: sdkData.nonceStr, // 必填，生成签名的随机串
								signature: sdkData.signature, // 必填，签名
								jsApiList: [
									'updateAppMessageShareData',
									'updateTimelineShareData',
								] // 必填，需要使用的JS接口列表
							});
							if(localStorage.getItem('disCouponDetail')) {
								that.couponDetail = JSON.parse(localStorage.getItem('disCouponDetail'))
							}
							that.setWx(); 
							that.getDetail(); //获取详情
							that.rangeDelivery(); //获取配送范围
							//返回数据
							// console.log(resp)
						})
					},
					shareImg() {
						this.$toast.loading({
							message: '正在生成海报...',
							forbidClick: true,
							duration: 0,
						});
						let that = this;
						let htmlDom = document.getElementById('newImg');
						that.$nextTick(() =>{
							try {
								html2canvas(htmlDom, {
									logging: false, //日志开关，便于查看html2canvas的内部执行流程
									backgroundColor: 'transparent',
									allowTaint: true,
									taintTest: false,
									useCORS: true,
									width: htmlDom.clientWidth, //dom 原始宽度
									height: htmlDom.clientHeight,
									scrollY: 0, 
									scrollX: 0,
								}).then(function(canvas) {
									// let imgUri = canvas.toDataURL("image/png", 2); // 获取生成的图片的url
									let imgUri = canvas.toDataURL();//图片地址
									that.testsrn = imgUri;
									that.dialogShareVisible = true
									that.$toast.clear()
								})
							}
							catch (err) {
								// that.$toast.clear()
								that.$toast(err.message ? err.message : '生成海报失败,请稍后重试')
							}
						})
							
					},
					shareGoods() {
						this.isShare = !this.isShare;
						let that = this;
						let shopInfo = JSON.parse(localStorage.getItem('shopInfo'));
						let goodsInfo = this.info
						let shop_name = shopInfo.shop_name
						let shop_id = shopInfo.id
						let logo = shopInfo.logo

						wx.updateTimelineShareData({
							title: goodsInfo.goods_name, // 分享标题
							desc: '我正在看' + goodsInfo.goods_name + ',快来看看吧!', // 分享描述
							// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							link: 'http://sy.xfd365.com/mobile/goodsDetails.html?id=' + goodsInfo.goods_id + '&shop_id=' + shop_id+'&v=1', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							imgUrl: goodsInfo.thumb, // 分享图标
							success: function() {
								console.log('good')
							}
						})
						wx.updateAppMessageShareData({
							title: goodsInfo.goods_name, // 分享标题
							desc: '我正在看' + goodsInfo.goods_name + ',快来看看吧!', // 分享描述
							// link: that.share_url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							link: 'http://sy.xfd365.com/mobile/goodsDetails.html?id=' + goodsInfo.goods_id + '&shop_id=' + shop_id+'&v=1', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
							imgUrl: goodsInfo.thumb, // 分享图标
							success: function() {
								console.log('good')
							}
						})
					},
					closePop() {
						this.dialogFormVisible = false;
					},
					//跳转首页
					JumpIndex() {
						localStorage.removeItem('dataPromotion')
						window.location.href = 'disCouponGoods.html?coupon_id='+this.coupon_id+'&user_coupon_id=' + this.user_coupon_id+'&v=1';
					},
					//返回上一页
					returnLast() {
						if(this.isPlay) {
							window.location.href = this.playUrl
							this.isPlay = false
							return
						}
						
						if(document.referrer == '') {
							window.location.href = 'disCouponGoods.html?v=1&coupon_id='+this.coupon_id+'&user_coupon_id='+this.user_coupon_id
							return
						}
						if (getQueryString('index')) {
                            window.location.href = 'disCouponGoods.html?v=1&coupon_id='+this.coupon_id+'&user_coupon_id='+this.user_coupon_id
                        } else {
                            window.history.go(-1);
                        }
						localStorage.removeItem('dataPromotion')

					},
					cancel() {
						// console.log("点击了浏览器的返回按钮");
						sessionStorage.clear();
						// window.history.back();
						this.returnLast();
					},
					handleClick(tab, event) {
						// console.log(tab.name);
					},
					// 立即购买
					atOnce(val) {
						var that = this;
						that.switch = 'yes';
						that.gouwu = '立即购买';
						that.goodsXq.is_now = 1;
						that.dialogFormVisible = true;
					},
					//加入购物车
					joinGoods() {
						var that = this;
						that.switch = 'no';
						that.gouwu = '加入购物车'
						that.goodsXq.is_now = 0;
						that.dialogFormVisible = true;
					},
					reduceChange() {
						let that = this;
						that.amount = that.amount - 1;
						if (that.amount < 1) {
							that.amount = 1;
						}
						let canBuyName = that.promotion_num - that.has_buy;
						let carNum = 0;
						that.cartList.forEach(function(ele) {
							if (ele.spcifi_id == that.spcifi_id && ele.goods_id == that.goods_id) {
								// console.log(ele)
								carNum = ele.number;
							}
						})
						if ((that.amount + carNum) <= canBuyName && that.has_buy != -1) {
							if (that.spcifi_id == 0) {
								that.decPrice = that.decSavePrce
							} else {
								that.checkItem()
							}

						}

					},
					addChange(goods_id) {
						let that = this;
						let canBuyName = that.promotion_num - that.has_buy;
						let carNum = 0;
						that.cartList.forEach(function(ele) {
							if (ele.spcifi_id == that.spcifi_id && ele.goods_id == that.goodId) {
								// console.log(ele)
								carNum = ele.number;
							}
						})
						if ((that.amount + carNum) >= that.storage) {
							that.$toast('库存不足')
							return;
						} else {
							if ((that.amount + carNum) == canBuyName && that.has_buy != -1) {
								that.$toast('每人限购' + that.promotion_num + '件，超出数量将按原价累加')
								that.decPrice = ''
							}
							that.amount = that.amount + 1
						}

					},
					//加入购物车
					joinCart(goods_id) {
						var that = this;
						var message = [];
						var length = 0;
						that.simulatedDATA.specifications.forEach(ele => {
							if (ele.length != 0) {
								length += 1
								message.push(ele.name)
							}
						})
						for (var i = 0; i < length; i++) {
							if (that.selectArr[i] == '') {
								this.$toast('请选择' + message[i])
								return
							}
						}

						let canBuyName = that.promotion_num - that.has_buy;
						let carNum = 0;
						that.cartList.forEach(function(ele) {
							if (ele.spcifi_id == that.spcifi_id) {
								carNum = ele.number;
							}
						})
						if ((that.amount + carNum) > that.storage) {
							that.$toast('库存不足')
							return
						} else {
							if ((that.amount + carNum) > canBuyName && that.has_buy != -1) {
								that.$toast('每人限购' + that.promotion_num + '件，超出数量将按原价累加')
							}
							that.goodsXq.number = that.amount;
							that.goodsXq.spcifi_id = that.spcifi_id
							that.goodsXq.coupon_id = that.coupon_id
							that.goodsXq.user_coupon_id = that.user_coupon_id
							that.dialogFormVisible = false;
							axios({
									method: 'post',
									url: that.JumpUrl.add,
									data: that.goodsXq
								})
								.then(function(resp) {
									if (resp.data.errno === 1) {
										that.$toast(resp.data.errmsg)
										return;
									}
									if (that.switch == 'yes') {
										if (!that.cate_id) {
											window.location.href = "disConfirmOrder.html" + '?is_now=' + 1 + '&id=' + that.goodId+ '&coupon_id='+that.coupon_id +'&user_coupon_id='+that.user_coupon_id;
										} else {
											window.location.href = "disConfirmOrder.html" + '?is_now=' + 1 + '&id=' + that.goodId + '&cate_id=' + that.cate_id +
												'&tabIndex=' + that.tabIndex+ '&coupon_id='+that.coupon_id+'&user_coupon_id='+that.user_coupon_id;
										}
									} else {
										that.$toast('添加成功')
										that.amount = 1;
									}

								}).catch(function(error) {
									//请求失败
									console.log('error', error);
								})
						}


					},
					// 在合成海报时，本地图片可以，网络图片报错，需要转换图片格式为base64才可以
					getImage() {
						let that = this;
						let img = new Image();
						// img.setAttribute('crossOrigin', 'anonymous');
						img.src = this.thumbImg;  
						// console.log(this.thumbImg)
						img.onload =function() {
							let data = that.getBase64Image(img);
							let url = URL.createObjectURL(that.base64ToBlob(data))
							that.thumbImgBase = url
							// console.log(that.thumbImgBase)
						}
					},
					// 图片转base64地址
					getBase64Image(img) {
						let canvas = document.createElement("canvas");
						canvas.width = img.width;
						canvas.height = img.height;
						let ctx = canvas.getContext("2d");
						ctx.drawImage(img, 0, 0, img.width, img.height);
						let dataURL = canvas.toDataURL("image/png");
						return dataURL
					},
					// base64转blob  勿删!!! 防止base64内容过大
					base64ToBlob(base64) {
						let parts = base64.split(';base64,');
						let contentType = parts[0].split(':')[1];
						let raw = window.atob(parts[1]);
						let rawLength = raw.length;
						let uInt8Array = new Uint8Array(rawLength);

						for (let i = 0; i < rawLength; ++i) {
							uInt8Array[i] = raw.charCodeAt(i);
						}
						return new Blob([uInt8Array], {type: contentType});
					},
				

					// 获取信息
					getDetail() {
						var that = this;
						that.$toast.loading({
							message: '加载中...',
							forbidClick: true,
						});
						axios({
								method: 'post',
								url: that.JumpUrl.detail,
								data: {
									goods_id: that.goods_id,
									coupon_id: that.coupon_id,
									user_coupon_id: that.user_coupon_id,
									token: that.token
								}
							})
							.then(function(resp) {
								that.$toast.clear();
								that.loading = 0;
								//返回数据
								that.info = resp.data.data.info;
								let thumb = resp.data.data.info.thumb
								that.thumbImg = thumb ? thumb : 'http://sy.xfd365.com/public/uploads/exp.jpg';
								that.videoUrl = resp.data.data.info.video_url
								that.getImage()

								that.qrcode = resp.data.data.qrcode;
								resp.data.data.attribute.forEach(ele => {
									if (ele.difference.charAt(ele.difference.length - 1) == ",") { // 一个属性最后两个逗号，两个属性最后一个逗号，三个属性最后没有逗号
										ele.difference = ele.difference.substr(0, ele.difference.length - 1);
										if (ele.difference.charAt(ele.difference.length - 1) == ",") {
											ele.difference = ele.difference.substr(0, ele.difference.length - 1);
										}
									}
								})
								resp.data.data.spcifi.forEach(ele => {
									if (ele != '') {
										that.simulatedDATA.specifications.push(ele)
									}
								})
								that.simulatedDATA.difference = resp.data.data.attribute
								that.spcifiList = resp.data.data.spcifi
								// that.simulatedDATA.specifications = resp.data.data.spcifi
								that.showImg = resp.data.data.info.thumb
								that.price = resp.data.data.info.retail_price
								that.decPrice = resp.data.data.info.promotion_price
								that.decSavePrce = resp.data.data.info.promotion_price
								that.promotion_num = resp.data.data.info.promotion_num
								that.storage = resp.data.data.info.storage
								that.has_buy = resp.data.data.info.has_buy


								let dataPromotion = localStorage.getItem('dataPromotion');
								if (dataPromotion) {
									dataPromotion = JSON.parse(dataPromotion)
									// console.log(dataPromotion.spcifi_name)
									if (dataPromotion.spcifi_name) {
										let array1 = [];
										let array2 = [];
										let array3 = []
										if (that.simulatedDATA.specifications.length == 1) {
											that.simulatedDATA.specifications[0].item.forEach(ele => {
												array1.push(ele.name)
											})
											that.selectArr = dataPromotion.spcifi_name.substr(0, dataPromotion.spcifi_name.length - 2).split(",");
										}
										if (that.simulatedDATA.specifications.length == 2) {
											that.simulatedDATA.specifications[0].item.forEach(ele => {
												array1.push(ele.name)
											})
											that.simulatedDATA.specifications[1].item.forEach(ele => {
												array2.push(ele.name)
											})
											that.selectArr = dataPromotion.spcifi_name.substr(0, dataPromotion.spcifi_name.length - 1).split(",");
										}
										if (that.simulatedDATA.specifications.length == 3) {
											that.simulatedDATA.specifications[0].item.forEach(ele => {
												array1.push(ele.name)
											})
											that.simulatedDATA.specifications[1].item.forEach(ele => {
												array2.push(ele.name)
											})
											that.simulatedDATA.specifications[2].item.forEach(ele => {
												array3.push(ele.name)
											})
											that.selectArr = dataPromotion.spcifi_name.substr(0, dataPromotion.spcifi_name.length).split(",");
										}

										if (that.selectArr.length == 1) {
											that.subIndex = [array1.indexOf(that.selectArr[0]), 0, 0]
										} else if (that.selectArr.length == 2) {
											that.subIndex = [array1.indexOf(that.selectArr[0]), array2.indexOf(that.selectArr[1]), 0]
										} else {
											that.subIndex = [array1.indexOf(that.selectArr[0]), array2.indexOf(that.selectArr[1]), array3.indexOf(
												that.selectArr[2])]
										}
										// console.log(that.subIndex)
									}
								} else {
									that.subIndex = [0, 0, 0]
									if (resp.data.data.attribute.length > 0) {
										if (resp.data.data.attribute[0].threeStylesName) {
											that.selectArr = [resp.data.data.attribute[0].oneStylesName, resp.data.data.attribute[0].twoStylesName,
												resp.data.data.attribute[0].threeStylesName
											]
										} else if (resp.data.data.attribute[0].twoStylesName && !resp.data.data.attribute[0].threeStylesName) {
											that.selectArr = [resp.data.data.attribute[0].oneStylesName, resp.data.data.attribute[0].twoStylesName]
										} else if (!resp.data.data.attribute[0].twoStylesName) {
											that.selectArr = [resp.data.data.attribute[0].oneStylesName]
										}
									}
								}


								// console.log(that.info)
								that.isCollect = resp.data.data.userHasCollect;
								that.salesShow = resp.data.data.salesShow

								for (var i in that.simulatedDATA.difference) {
									that.shopItemInfo[that.simulatedDATA.difference[i].difference] = that.simulatedDATA.difference[i]; //修改数据结构格式，改成键值对的方式，以方便和选中之后的值进行匹配
								}

								// console.log(that.simulatedDATA)
								// console.log(that.shopItemInfo)

								that.checkItem();


								// 判断购物车是否已添加及数量
								let carNum = 0;
								that.cartList.forEach(function(ele) {
									if (ele.spcifi_id == that.spcifi_id && ele.goods_id == that.goodId) {
										carNum = ele.number;
									}
								})
								if (carNum >= (that.promotion_num - that.has_buy)) {
									that.decPrice = ''
								}

							}).catch(function(error) {
								that.$toast.clear();
								//请求失败
								console.log('error', error);

							})
					},
					wechatLogin() {
						var that = this;
						axios({
								method: 'post',
								url: that.JumpUrl.loginUrl,
								data: {
									code: that.code,
									shop_id: that.shop_id
								}
							})
							.then(function(resp) {
								//返回数据
								that.token = resp.data.token;
								localStorage.setItem('token', that.token);
								if (that.token) {
									that.getJssdk()
								}

							}).catch(function(error) {
								//请求失败
								console.log('error', error);

							})
					},
					wxSign() {
						var that = this;
						let back_url = 'http://sy.xfd365.com/mobile/disGoodsDetails.html?id=' + that.goods_id + '&coupon_id=' + that.coupon_id+'&user_coupon_id='+that.user_coupon_id+'&v=1';
						axios({
							method: 'post',
							url: 'http://sy.xfd365.com/wx/wechat/get_jump_url',
							data: {
								back_url: back_url,
							}
						})
						.then(function(resp) {
							//返回数据
							window.location.href = resp.data.url;
						})
					},
					// 删除上个页面存储数据
					removeLocal() {
						localStorage.removeItem('getCouponData')
						localStorage.removeItem('myCouponToDetail')
						localStorage.removeItem('myCouponList')
					},
					checkPhone() {
						var _this = this
						var agent = (navigator.userAgent || navigator.vendor || window.opera)
						if (agent != null) {
							var agentName = agent.toLowerCase()
							if (/android/i.test(agentName)) {
								return 'android'
							} else if (/iphone/i.test(agentName)) {
								return 'ios'
							}
						}
					},
				},
				//获取购物车内容
				created() {
					let phoneType = this.checkPhone()
					// 监听页面关闭事件
					if(phoneType == 'android'){
						window.onunload = function () {
							this.removeLocal()
						}
					} else if(phoneType == 'ios') {
						window.addEventListener('pagehide', function () {
							this.removeLocal()
						});
					}
					//判断登录
					let shop_id = getQueryString('shop_id');
					var goodsName = getQueryString('goodsName')
					this.goodsName = decodeURIComponent(goodsName)
					this.goodId = getQueryString('id')

					var cate_id = getQueryString('cate_id')
					var tabIndex = getQueryString('tabIndex')
					this.coupon_id = getQueryString('coupon_id')
					this.user_coupon_id = getQueryString('user_coupon_id')
					// var cate_id = localStorage.getItem('cate_id')
					// var tabIndex = localStorage.getItem('tabIndex')

					var scrollTop = getQueryString('scrollTop')
					if (cate_id) {
						this.cate_id = cate_id
					}
					if (tabIndex) {
						this.tabIndex = tabIndex
					}
					if (scrollTop) {
						this.scrollTop = scrollTop
					}

					if (!shop_id) {
						shop_id = localStorage.getItem('shop_id');
					} else if (shop_id) {
						this.shop_id = shop_id;
						localStorage.setItem('shop_id', shop_id);
					}

					let code = getQueryString('code');
					if (code) {
						this.code = code;
					}

					var token = localStorage.getItem("token");
					if (token) {
						this.token = token;
					}

					let goods_id = getQueryString('id');
					this.goodsXq.goods_id = goods_id
					this.goods_id = goods_id

					if (this.code) {
						this.wechatLogin()
					} else {
						if (token) {
							this.checkToken()
						} else {
							this.wxSign()
						}
					}
				},
			})
		</script>
	</body>

</html>
